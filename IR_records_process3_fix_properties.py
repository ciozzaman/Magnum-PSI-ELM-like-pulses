import numpy as np
exec(open("/home/ffederic/work/analysis_scripts/scripts/preamble_import_pc.py").read())
# import matplotlib.pyplot as plt
#import .functions
os.chdir('/home/ffederic/work/Collaboratory/test/experimental_data')
from functions.spectools import rotate,do_tilt, binData, get_angle, get_tilt,get_angle_2
from functions.Calibrate import do_waveL_Calib, do_Intensity_Calib
from functions.fabio_add import find_nearest_index,multi_gaussian,all_file_names,load_dark,find_index_of_file,get_metadata,movie_from_data,get_angle_no_lines,do_tilt_no_lines,four_point_transform,fix_minimum_signal,fix_minimum_signal2,get_bin_and_interv_no_lines,examine_current_trace
from functions.GetSpectrumGeometry import getGeom
from functions.SpectralFit import doSpecFit_single_frame
from functions.GaussFitData import doLateralfit_time_tependent
import collections

import os,sys
from PIL import Image
import xarray as xr
import pandas as pd
import copy
from uncertainties.unumpy import exp,nominal_values,std_devs,erf
from uncertainties import ufloat,unumpy,correlated_values
from scipy.optimize import curve_fit
from scipy import interpolate
from scipy.signal import find_peaks, peak_prominences as get_proms
from multiprocessing import Pool,cpu_count
number_cpu_available = cpu_count()
print('Number of cores available: '+str(number_cpu_available))


os.chdir('/home/ffederic/work/Collaboratory/test/experimental_data/functions')
print(os.path.abspath(os.getcwd()))
import pyradi.ryptw as ryptw

fdir = '/home/ffederic/work/Collaboratory/test/experimental_data'
df_log = pd.read_csv('/home/ffederic/work/Collaboratory/test/experimental_data/functions/Log/shots_3.csv',index_col=0)
df_settings = pd.read_csv('/home/ffederic/work/Collaboratory/test/experimental_data/functions/Log/settings_3.csv',index_col=0)
figure_index=0


# molybdenum data
thermal_conductivity = 126	# W/mK
heat_capacity = 305	# J/kg k
density = 370	# kg/m3
color = ['b', 'r', 'm', 'y', 'g', 'c', 'k', 'slategrey', 'darkorange', 'lime', 'pink', 'gainsboro', 'paleturquoise', 'teal', 'olive']


def exponential_decay(time,*args):
	out = args[1]*np.exp(-(time-args[3])/args[2]) + args[0]
	return out

def semi_infinite_sink_full_increase(max_total_time):
	def function(time,*args):
		out = (args[1]/((max_total_time-args[3])*args[2]))*2/((np.pi*thermal_conductivity*heat_capacity*density)**0.5) *((time-args[3])**0.5) + args[0]
		# print(out)
		return np.nanmax([np.ones_like(out)*args[0],out],axis=0)
	return function

def semi_infinite_sink_full_decrease(max_total_time):
	def function(time,*args):
		out = (args[1]/((max_total_time-args[3])*args[2]))*2/((np.pi*thermal_conductivity*heat_capacity*density)**0.5) *((time-args[3])**0.5 - (time-args[3]-(max_total_time-args[3])*args[2])**0.5) + args[0]
		# print(out)
		return np.nanmax([np.zeros_like(out),out],axis=0)
	return function

def gaussian_1D_fitting(spatial_coord,*args):
	out = args[1]*np.exp(- (spatial_coord**2)/(2*(args[2]**2)) ) + args[0]
	return out

def power_input(time,r):
	out = 8e8*np.exp(-(r**2)/(2*(0.005**2)))*(0.0917*0.1+0.5*0.7*np.exp(-((time-0.00033)**2)/(2*(0.000144**2)))+0.5*0.208*np.exp(-((time-0.000457)**2)/(2*(0.000218**2))))
	return out

# simulated strong pulses
# heat_flux = 8e8e^(-(r^2)/(2*(0.005^2)))*(0.0917*0.1+0.5*0.7*e^(-((t-0.00033-1)^2)/(2*(0.000144^2)))+0.5*0.208*e^(-((t-0.000457-1)^2)/(2*(0.000218^2))))

a=np.array([0,0.00000500679,0.0000109673,0.0000181198,0.0000268221,0.0000371933,0.0000457764,0.0000538826,0.000061512,0.0000687838,0.0000755787,0.000082016,0.0000882149,0.0000940561,0.000099659,0.000105023,0.000111461,0.000116348,0.00012219,0.000126719,0.000132203,0.000136495,0.000141501,0.000145555,0.000150323,0.000154138,0.000158787,0.000162363,0.000166774,0.00017035,0.000174522,0.00017786,0.000181913,0.000185251,0.000189185,0.000192404,0.000196218,0.000199318,0.000203013,0.000206113,0.000209689,0.000212669,0.000216246,0.000219226,0.000222802,0.000225663,0.00022912,0.000231981,0.000235438,0.000238299,0.000241756,0.000244498,0.000247955,0.000250697,0.000254154,0.000257015,0.000260353,0.000263214,0.000266552,0.000269413,0.000272751,0.000275612,0.000279069,0.00028193,0.000285387,0.000288367,0.000291824,0.000294805,0.000298381,0.000301361,0.000304937,0.000308037,0.000311732,0.000314951,0.000318766,0.000322104,0.000326037,0.000329971,0.000333548,0.00033772,0.000341296,0.000345707,0.000349641,0.00035429,0.000358462,0.00036335,0.000367761,0.000373006,0.000377774,0.000383377,0.000388503,0.000394464,0.000399947,0.000406504,0.000412345,0.000419378,0.000425816,0.000433564,0.000440478,0.000448942,0.000456572,0.00046587,0.000474334,0.000484586,0.000494123,0.000505447,0.000516176,0.000529051,0.000538826,0.000548243,0.000557065,0.000567794,0.0005759,0.000585675,0.000593424,0.000602841,0.00061059,0.000619769,0.000627398,0.000636697,0.000644445,0.000653744,0.000661612,0.000671029,0.000679135,0.00068891,0.000697255,0.000707388,0.00071609,0.000726461,0.000735521,0.000746489,0.000756025,0.000767469,0.000777483,0.000789523,0.000800133,0.000812769,0.000823975,0.000837445,0.000849485,0.00086379,0.000876546,0.000891924,0.000905633,0.000922203,0.000937223,0.000955105,0.000971436,0.000991106,0.00100923,0.00103104,0.00105119,0.00107551,0.00109839,0.00112569,0.00115168,0.00118291,0.00121272,0.00124848,0.00128281,0.00132406,0.00137341,0.00141692,0.00146914,0.00153184,0.00158703,0.00165319,0.00171006,0.00178945,0.00186455,0.00195479,0.00206292,0.00216162,0.00228,0.00242221,0.00255406,0.00271237,0.00290239,0.00308335,0.00330043,0.00356102,0.00387371,0.00417125,0.00452828,0.0049566,0.00547075,0.00607073,0.00667071,0.00727081,0.00787079,0.00847077,0.00907075,0.00967073,0.0102707,0.0108708,0.0114708,0.0120708,0.0126708,0.0132707,0.0138707,0.0144708,0.0150708,0.0156708,0.0162708,0.0168707,0.0174707,0.0180708,0.0186708,0.0192708,0.0198708,0.0204707,0.0210707,0.0216708,0.0222708,0.0228708,0.0234708,0.0240707,0.0246707,0.0252708,0.0258708,0.0264708,0.0270708,0.0276707,0.0282707,0.0288708,0.0294708,0.03])
b=np.array([650.453,666.875,679.064,691.448,705.66,723.127,738.317,753.639,768.944,784.258,799.585,814.928,830.286,845.66,861.05,876.455,895.887,911.149,930.272,945.594,964.692,980.056,999.121,1014.52,1033.56,1048.99,1068.01,1083.47,1102.46,1117.95,1136.93,1152.45,1171.41,1186.95,1205.9,1221.46,1240.4,1255.98,1274.92,1290.52,1309.44,1325.06,1343.98,1359.62,1378.54,1394.19,1413.11,1428.78,1447.69,1463.38,1482.29,1497.99,1516.9,1532.63,1551.53,1567.28,1586.17,1601.94,1620.84,1636.63,1655.52,1671.33,1690.22,1706.05,1724.94,1740.79,1759.68,1775.56,1794.44,1810.34,1829.22,1845.15,1864.02,1879.98,1898.85,1914.84,1933.69,1952.53,1968.58,1987.39,2003.49,2022.28,2038.41,2057.12,2073.15,2091.61,2107.36,2125.33,2140.57,2157.76,2172.21,2188.25,2201.58,2216.03,2227.79,2240.12,2249.82,2259.38,2266.39,2272.45,2276.07,2277.78,2277.2,2273.63,2268,2258.21,2246.66,2229.8,2215.46,2200.55,2185.53,2166.4,2151.31,2132.6,2117.3,2098.61,2083.17,2064.51,2048.98,2030.34,2014.73,1996.11,1980.43,1961.82,1946.09,1927.49,1911.71,1893.12,1877.3,1858.71,1842.86,1824.27,1808.38,1789.8,1773.89,1755.31,1739.37,1720.79,1704.83,1686.26,1670.27,1651.73,1635.71,1617.19,1601.14,1582.66,1566.58,1548.15,1532.04,1513.67,1497.53,1479.21,1463.05,1444.8,1428.61,1410.42,1394.21,1376.08,1359.86,1341.76,1325.53,1307.45,1287.51,1271.15,1252.98,1233,1216.62,1198.51,1183.98,1165.33,1149.03,1131.1,1111.57,1095.19,1077.3,1057.96,1041.58,1023.82,1004.8,988.426,970.867,952.251,932.752,916.31,899.039,881.122,862.776,844.675,829.177,815.765,804.05,793.735,784.588,776.428,769.107,762.508,756.533,751.102,746.148,741.614,737.452,733.623,730.09,726.822,723.794,720.982,718.367,715.929,713.654,711.526,709.534,707.667,705.913,704.265,702.713,701.251,699.871,698.568,697.335,696.168,695.063,694.014,693.018,692.072,691.171,690.314,689.496,688.804])
a1=np.array([0,0.000123143,0.000246406,0.000369549,0.000492811,0.000615954,0.000616193,0.000616312,0.000616431,0.00061655,0.00061667,0.000616789,0.000616908,0.000617027,0.000617147,0.000617385,0.000617504,0.000617623,0.000617742,0.000617862,0.000617981,0.0006181,0.000618219,0.000618458,0.000618577,0.000618696,0.000618815,0.000618935,0.000619054,0.000619173,0.000619292,0.000619531,0.00061965,0.000619769,0.000619888,0.000620007,0.000620127,0.000620246,0.000620365,0.000620604,0.000620723,0.000620842,0.000620961,0.00062108,0.0006212,0.000621319,0.000621438,0.000621676,0.000621796,0.000621915,0.000622034,0.000622153,0.000622272,0.000622392,0.000622511,0.000622749,0.000622869,0.000622988,0.000623107,0.000623226,0.000623345,0.000623465,0.000623584,0.000623822,0.000623941,0.000624061,0.00062418,0.000624299,0.000624418,0.000624538,0.000624657,0.000624895,0.000625014,0.000625134,0.000625253,0.000625372,0.000625491,0.00062561,0.00062573,0.000625968,0.000626087,0.000626206,0.000626326,0.000626445,0.000626564,0.000626683,0.000626802,0.000627041,0.00062716,0.000627279,0.000627398,0.000627518,0.000627637,0.000627756,0.000627875,0.000628114,0.000628233,0.000628352,0.000628471,0.000628591,0.00062871,0.000628829,0.000628948,0.000629187,0.000629306,0.000629425,0.000631452,0.000633359,0.000635385,0.000637412,0.000639439,0.000641346,0.000643372,0.000645399,0.000647426,0.000649452,0.00065136,0.000653386,0.000655413,0.000657439,0.000659347,0.000661373,0.0006634,0.000665426,0.000667453,0.00066936,0.000671387,0.000673413,0.00067544,0.000677347,0.000679374,0.0006814,0.000683427,0.000685453,0.000687361,0.000689387,0.000691414,0.00069344,0.000695348,0.000697374,0.000699401,0.000701427,0.000703454,0.000705361,0.000707388,0.000709414,0.000711441,0.000713348,0.000715375,0.000717401,0.000719428,0.000721455,0.000723362,0.000725389,0.000727415,0.000729442,0.00077939,0.000829458,0.000879407,0.000929356,0.000979424,0.00102937,0.00107944,0.00112939,0.00117946,0.00122941,0.00127935,0.00132942,0.00137937,0.00142944,0.00147939,0.00152946,0.0015794,0.00162935,0.00167942,0.00172937,0.00177944,0.00182939,0.00187945,0.0019294,0.00197935,0.00202942,0.00207937,0.00212944,0.00217938,0.00222945,0.0022794,0.00232935,0.00237942,0.00242937,0.00247943,0.00252938,0.00257945,0.0026294,0.00267935,0.00272942,0.00277936,0.00282943,0.00287938,0.00292945,0.0029794,0.00302935,0.00307941,0.00312936,0.00317943,0.00322938,0.00327945,0.0033294,0.00337935,0.00342941,0.00347936,0.00352943,0.00357938,0.00362945,0.00367939,0.00372934,0.00377941,0.00382936,0.00387943,0.00392938,0.00397944,0.00402939,0.00407934,0.00412941,0.00417936,0.00422943,0.00427938,0.00432944,0.00437939,0.00442946,0.00447941,0.00452936,0.00457942,0.00462937,0.00467944,0.00472939,0.00477946,0.00482941,0.00487936,0.00492942,0.00497937,0.00502944,0.00507939,0.00512946,0.0051794,0.00522935,0.00527942,0.00532937,0.00537944,0.00542939,0.00547946,0.0055294,0.00557935,0.00562942,0.00567937,0.00572944,0.00582945,0.00592935,0.00602937,0.00612938,0.0062294,0.00632942,0.00642943,0.00652945,0.00662935,0.00672936,0.00682938,0.0069294,0.00702941,0.00712943,0.00722945,0.00732935,0.00742936,0.00752938,0.00762939,0.00772941,0.00782943,0.00792944,0.00802934,0.00812936,0.00822938,0.00832939,0.00842941,0.00852943,0.00862944,0.00872946,0.00882936,0.00892937,0.00902939,0.00912941,0.00922942,0.00932944,0.00942945,0.00952935,0.00962937,0.00972939,0.0098294,0.00992942,0.0100294,0.0101294,0.0102293,0.0103294,0.0104294,0.0105294,0.0106294,0.0107294,0.0111294,0.0115295,0.0119294,0.0123295,0.0127294,0.0131293,0.0135294,0.0139294,0.0143294,0.0147294,0.0151294,0.0155294,0.0159293,0.0163294,0.0167294,0.0171294,0.0175294,0.0179294,0.0183294,0.0187295,0.0191294,0.0195293,0.0199294,0.0203294,0.0207294,0.0211294,0.0215294,0.0219294,0.0223295,0.0227294,0.0231293,0.0235294,0.0239294,0.0243294,0.0247294,0.0251294,0.0255294,0.0259294,0.0263294,0.0267293,0.0271294,0.0275294,0.0279294,0.0283294,0.0287294,0.0291294,0.0295294,0.0299294,0.0303294,0.0307294])
b1=np.array([650.453,650.453,650.453,650.453,650.453,650.453,1111.04,1525.29,1870.46,2168.6,2433.98,2675.2,2897.77,3105.38,3300.68,3485.62,3661.67,3830.01,3991.55,4147.07,4297.18,4442.41,4583.21,4719.96,4852.99,4982.59,5109,5232.46,5353.16,5471.27,5586.97,5700.38,5811.64,5920.87,6028.17,6133.65,6237.39,6339.47,6439.98,6538.98,6636.55,6732.73,6827.59,6921.18,7013.55,7104.74,7194.81,7283.78,7371.71,7458.62,7544.56,7629.54,7713.61,7796.79,7879.11,7960.6,8041.27,8121.17,8200.3,8278.68,8356.35,8433.31,8509.59,8585.2,8660.17,8734.51,8808.23,8881.34,8953.87,9025.83,9097.23,9168.08,9238.4,9308.2,9377.48,9446.27,9514.56,9582.38,9649.73,9716.61,9783.05,9849.05,9914.61,9979.75,10044.5,10108.8,10172.7,10236.2,10299.4,10362.1,10424.5,10486.5,10548.2,10609.5,10670.4,10731.1,10791.3,10851.3,10910.9,10970.2,11029.2,11087.9,11146.3,11204.3,11262.1,11319.6,8924.92,7756.58,7013.69,6477.13,6062.36,5727.77,5449.75,5213.61,5009.59,4830.91,4672.65,4531.16,4403.63,4287.9,4182.23,4085.25,3995.8,3912.97,3835.96,3764.13,3696.91,3633.83,3574.48,3518.51,3465.6,3415.48,3367.92,3322.7,3279.64,3238.57,3199.34,3161.82,3125.89,3091.43,3058.35,3026.55,2995.97,2966.51,2938.12,2910.73,2884.29,2858.73,2834.01,2810.09,2786.92,2764.47,2742.7,2721.57,2701.05,2681.12,2364.21,2146.6,1987.99,1866.9,1771.04,1692.94,1627.82,1572.5,1524.77,1483.05,1446.17,1413.27,1383.67,1356.87,1332.43,1310.03,1289.41,1270.32,1252.6,1236.08,1220.64,1206.15,1192.52,1179.68,1167.54,1156.05,1145.14,1134.78,1124.91,1115.5,1106.51,1097.91,1089.68,1081.78,1074.2,1066.92,1059.91,1053.16,1046.66,1040.38,1034.32,1028.47,1022.8,1017.32,1012.02,1006.87,1001.88,997.046,992.347,987.783,983.347,979.033,974.836,970.75,966.771,962.895,959.117,955.432,951.838,948.331,944.907,941.563,938.297,935.105,931.984,928.932,925.947,923.026,920.167,917.368,914.627,911.942,909.311,906.732,904.205,901.726,899.295,896.91,894.571,892.274,890.02,887.807,885.634,883.499,881.402,879.341,877.316,875.326,873.369,871.445,869.553,867.692,865.861,864.059,862.287,860.542,858.825,857.135,855.47,853.831,850.65,847.562,844.562,841.646,838.812,836.055,833.372,830.761,828.218,825.741,823.328,820.975,818.68,816.442,814.257,812.125,810.044,808.011,806.024,804.084,802.187,800.332,798.518,796.743,795.007,793.308,791.644,790.016,788.421,786.859,785.328,783.828,782.358,780.917,779.504,778.119,776.76,775.426,774.118,772.834,771.574,770.338,769.123,767.931,766.76,765.61,764.479,763.369,762.278,761.206,757.19,753.424,749.887,746.559,743.424,740.467,737.674,735.032,732.532,730.162,727.914,725.779,723.75,721.82,719.982,718.231,716.562,714.968,713.447,711.992,710.602,709.271,707.997,706.776,705.606,704.483,703.406,702.372,701.378,700.422,699.503,698.619,697.768,696.948,696.158,695.396,694.661,693.952,693.268,692.606,691.967,691.35,690.753,690.175,689.615,689.073,688.548,688.04,687.547,687.068])
a2=np.array([0,0,0,0.000000119209,0.000000119209,0.000000119209,0.0000108481,0.0000216961,0.0000325441,0.000043273,0.000054121,0.0000648498,0.0000756979,0.0000865459,0.0000972748,0.000108123,0.000118852,0.0001297,0.000140548,0.000151277,0.000162125,0.000172854,0.000183701,0.00019455,0.000205278,0.000216126,0.000226855,0.000237703,0.000248551,0.00025928,0.000270128,0.000280857,0.000291705,0.000302553,0.000313282,0.00032413,0.000334859,0.000345707,0.000356555,0.000367284,0.000378132,0.000388861,0.000399709,0.000410557,0.000421286,0.000432134,0.000442862,0.000453711,0.000464559,0.000475287,0.000486136,0.000496864,0.000507712,0.000518441,0.000529289,0.000540137,0.000550866,0.000561714,0.000572443,0.000583291,0.000594139,0.000604868,0.000615716,0.000626445,0.000637293,0.000648141,0.00065887,0.000669718,0.000680447,0.000691295,0.000702143,0.000712872,0.00072372,0.000734448,0.000745296,0.000756144,0.000766873,0.000777721,0.00078845,0.000799298,0.000810146,0.000820875,0.000831723,0.000842452,0.0008533,0.000864148,0.000874877,0.000885725,0.000896454,0.000907302,0.00091815,0.000928879,0.000939727,0.000950456,0.000961304,0.000972152,0.000982881,0.000993729,0.00100446,0.00101531,0.00102615,0.00103688,0.00104773,0.00105846,0.00106931,0.00108015,0.00108206,0.00108409,0.00108612,0.00108814,0.00109005,0.00109208,0.0010941,0.00109613,0.00109816,0.00110006,0.00110209,0.00110412,0.00110614,0.00110805,0.00111008,0.0011121,0.00111413,0.00111616,0.00111806,0.00112009,0.00112212,0.00112414,0.00112605,0.00112808,0.0011301,0.00113213,0.00113416,0.00113606,0.00113809,0.00114012,0.00114214,0.00114405,0.00114608,0.0011481,0.00115013,0.00115216,0.00115406,0.00115609,0.00115812,0.00116015,0.00116205,0.00116408,0.0011661,0.00116813,0.00117016,0.00117207,0.00117409,0.00117612,0.00117815,0.00118005,0.00123012,0.00128007,0.00133014,0.00138009,0.00143015,0.0014801,0.00153005,0.00158012,0.00163007,0.00168014,0.00173008,0.00178015,0.0018301,0.00188005,0.00193012,0.00198007,0.00203013,0.00208008,0.00213015,0.0021801,0.00223005,0.00228012,0.00233007,0.00238013,0.00243008,0.00248015,0.0025301,0.00258005,0.00263012,0.00268006,0.00273013,0.00278008,0.00283015,0.0028801,0.00293005,0.00298011,0.00303006,0.00308013,0.00313008,0.00318015,0.0032301,0.00328004,0.00333011,0.00338006,0.00343013,0.00348008,0.00353015,0.00358009,0.00363004,0.00368011,0.00373006,0.00378013,0.00383008,0.00388014,0.00393009,0.00398004,0.00403011,0.00408006,0.00413013,0.00418007,0.00423014,0.00428009,0.00433016,0.00438011,0.00443006,0.00448012,0.00453007,0.00458014,0.00463009,0.00468016,0.00473011,0.00478005,0.00483012,0.00488007,0.00493014,0.00498009,0.00503015,0.0050801,0.00513005,0.00518012,0.00523007,0.00528014,0.00533009,0.00538015,0.0054301,0.00548005,0.00553012,0.00558007,0.00563014,0.00568008,0.00573015,0.0057801,0.00583005,0.00588012,0.00593007,0.00598013,0.00603008,0.00608015,0.0061301,0.00618005,0.00628006,0.00638008,0.0064801,0.00658011,0.00668013,0.00678015,0.00688005,0.00698006,0.00708008,0.0071801,0.00728011,0.00738013,0.00748014,0.00758004,0.00768006,0.00778008,0.00788009,0.00798011,0.00808013,0.00818014,0.00828016,0.00838006,0.00848007,0.00858009,0.00868011,0.00878012,0.00888014,0.00898016,0.00908005,0.00918007,0.00928009,0.0093801,0.00948012,0.00958014,0.00968015,0.00978005,0.00988007,0.00998008,0.0100801,0.0101801,0.0102801,0.0103801,0.01048,0.0105801,0.0106801,0.0107801,0.0108801,0.0109801,0.0110802,0.01118,0.0115801,0.0119801,0.0123801,0.0127801,0.0131801,0.0135801,0.0139802,0.0143801,0.01478,0.0151801,0.0155801,0.0159801,0.0163801,0.0167801,0.0171801,0.0175801,0.0179801,0.01838,0.0187801,0.0191801,0.0195801,0.0199801,0.0203801,0.0207801,0.0211801,0.0215801,0.0219801,0.0223801,0.0227801,0.0231801,0.0235801,0.0239801,0.0243801,0.0247802,0.0251801,0.0255801,0.0259801,0.0263801,0.0267801,0.0271801,0.0275801,0.0279801,0.0283802,0.0287801,0.02918,0.0295801,0.0299801,0.0303801,0.0307801,0.0311801])
b2=np.array([650.453,650.453,650.453,650.453,650.453,650.453,750.51,804.943,845.841,879.912,909.705,936.497,961.036,983.802,1005.13,1025.25,1044.34,1062.55,1079.99,1096.74,1112.88,1128.46,1143.54,1158.17,1172.38,1186.19,1199.66,1212.78,1225.6,1238.13,1250.38,1262.38,1274.14,1285.66,1296.98,1308.08,1318.99,1329.72,1340.27,1350.64,1360.86,1370.92,1380.83,1390.6,1400.23,1409.73,1419.1,1428.35,1437.48,1446.49,1455.4,1464.2,1472.89,1481.48,1489.98,1498.38,1506.69,1514.91,1523.05,1531.1,1539.07,1546.96,1554.77,1562.51,1570.17,1577.76,1585.28,1592.73,1600.12,1607.44,1614.69,1621.89,1629.02,1636.09,1643.11,1650.07,1656.97,1663.82,1670.61,1677.35,1684.04,1690.68,1697.27,1703.81,1710.3,1716.75,1723.15,1729.5,1735.81,1742.08,1748.3,1754.48,1760.63,1766.72,1772.79,1778.81,1784.79,1790.73,1796.64,1802.51,1808.34,1814.13,1819.9,1825.62,1831.32,1836.97,1799.71,1777.68,1761.21,1747.61,1735.83,1725.32,1715.77,1706.97,1698.78,1691.11,1683.87,1677,1670.47,1664.22,1658.23,1652.48,1646.94,1641.59,1636.42,1631.41,1626.56,1621.84,1617.25,1612.78,1608.43,1604.18,1600.04,1595.99,1592.03,1588.16,1584.37,1580.65,1577.01,1573.44,1569.94,1566.5,1563.12,1559.8,1556.54,1553.33,1550.17,1547.07,1544.01,1541,1538.03,1535.11,1532.23,1529.39,1526.6,1523.84,1469.54,1425.02,1387.42,1354.96,1326.45,1301.09,1278.28,1257.58,1238.66,1221.26,1205.17,1190.22,1176.28,1163.22,1150.96,1139.41,1128.51,1118.18,1108.38,1099.07,1090.2,1081.74,1073.65,1065.91,1058.5,1051.38,1044.55,1037.98,1031.65,1025.55,1019.67,1013.99,1008.51,1003.2,998.066,993.093,988.273,983.599,979.063,974.66,970.381,966.222,962.177,958.241,954.409,950.677,947.04,943.495,940.037,936.663,933.371,930.155,927.015,923.947,920.947,918.015,915.147,912.341,909.595,906.906,904.274,901.695,899.169,896.693,894.266,891.887,889.553,887.264,885.018,882.814,880.651,878.527,876.441,874.393,872.38,870.403,868.46,866.55,864.672,862.826,861.01,859.225,857.468,855.74,854.039,852.365,850.718,849.096,847.499,845.927,844.378,842.852,841.35,839.869,838.41,836.973,835.556,834.159,832.782,831.424,828.783,826.213,823.711,821.275,818.901,816.588,814.333,812.134,809.988,807.895,805.851,803.856,801.907,800.003,798.142,796.323,794.544,792.805,791.103,789.438,787.809,786.213,784.651,783.122,781.623,780.155,778.716,777.306,775.923,774.568,773.239,771.935,770.655,769.4,768.168,766.959,765.772,764.607,763.463,762.339,761.235,760.15,759.084,758.037,757.008,755.996,755.002,754.024,753.062,752.116,748.567,745.23,742.09,739.129,736.335,733.695,731.197,728.831,726.588,724.46,722.438,720.515,718.686,716.944,715.283,713.699,712.187,710.742,709.362,708.041,706.777,705.566,704.406,703.294,702.226,701.202,700.218,699.272,698.363,697.489,696.647,695.836,695.055,694.303,693.577,692.877,692.201,691.549,690.919,690.309,689.72,689.151,688.599,688.066,687.549,687.048,686.562,686.091,685.635,685.191])
a3=np.array([0,0.00015235,0.000304818,0.000457168,0.000609636,0.000761986,0.000762224,0.000762343,0.000762463,0.000762701,0.00076282,0.000762939,0.000763178,0.000763297,0.000763536,0.000763655,0.000763774,0.000764012,0.000764131,0.00076437,0.000764489,0.000764608,0.000764847,0.000764966,0.000765204,0.000765324,0.000765443,0.000765681,0.000765801,0.000766039,0.000766158,0.000766277,0.000766516,0.000766635,0.000766873,0.000766993,0.000767112,0.00076735,0.000767469,0.000767589,0.000767827,0.000767946,0.000768185,0.000768304,0.000768423,0.000768661,0.000768781,0.000769019,0.000769138,0.000769258,0.000769496,0.000769615,0.000769854,0.000769973,0.000770092,0.00077033,0.00077045,0.000770688,0.000770807,0.000770926,0.000771165,0.000771284,0.000771403,0.000771642,0.000771761,0.000771999,0.000772119,0.000772238,0.000772476,0.000772595,0.000772834,0.000772953,0.000773072,0.000773311,0.00077343,0.000773668,0.000773788,0.000773907,0.000774145,0.000774264,0.000774503,0.000774622,0.000774741,0.00077498,0.000775099,0.000775337,0.000775456,0.000775576,0.000775814,0.000775933,0.000776053,0.000776291,0.00077641,0.000776648,0.000776768,0.000776887,0.000777125,0.000777245,0.000777483,0.000777602,0.000777721,0.00077796,0.000778079,0.000778318,0.000778437,0.000778556,0.000780582,0.000782609,0.000784635,0.000786543,0.000788569,0.000790596,0.000792623,0.000794649,0.000796556,0.000798583,0.00080061,0.000802636,0.000804543,0.00080657,0.000808597,0.000810623,0.00081265,0.000814557,0.000816584,0.00081861,0.000820637,0.000822544,0.000824571,0.000826597,0.000828624,0.00083065,0.000832558,0.000834584,0.000836611,0.000838637,0.000840545,0.000842571,0.000844598,0.000846624,0.000848651,0.000850558,0.000852585,0.000854611,0.000856638,0.000858545,0.000860572,0.000862598,0.000864625,0.000866652,0.000868559,0.000870585,0.000872612,0.000874639,0.000876546,0.000878573,0.00092864,0.000978589,0.00102866,0.00107861,0.00112855,0.00117862,0.00122857,0.00127864,0.00132859,0.00137865,0.0014286,0.00147855,0.00152862,0.00157857,0.00162864,0.00167859,0.00172865,0.0017786,0.00182855,0.00187862,0.00192857,0.00197864,0.00202858,0.00207865,0.0021286,0.00217855,0.00222862,0.00227857,0.00232863,0.00237858,0.00242865,0.0024786,0.00252855,0.00257862,0.00262856,0.00267863,0.00272858,0.00277865,0.0028286,0.00287855,0.00292861,0.00297856,0.00302863,0.00307858,0.00312865,0.0031786,0.00322855,0.00327861,0.00332856,0.00337863,0.00342858,0.00347865,0.00352859,0.00357854,0.00362861,0.00367856,0.00372863,0.00377858,0.00382864,0.00387859,0.00392854,0.00397861,0.00402856,0.00407863,0.00412857,0.00417864,0.00422859,0.00427854,0.00432861,0.00437856,0.00442863,0.00447857,0.00452864,0.00457859,0.00462866,0.00467861,0.00472856,0.00477862,0.00482857,0.00487864,0.00492859,0.00497866,0.00502861,0.00507855,0.00512862,0.00517857,0.00522864,0.00527859,0.00532865,0.0053786,0.00542855,0.00547862,0.00552857,0.00557864,0.00562859,0.00567865,0.0057286,0.00577855,0.00582862,0.00587857,0.00597858,0.0060786,0.00617862,0.00627863,0.00637865,0.00647855,0.00657856,0.00667858,0.0067786,0.00687861,0.00697863,0.00707865,0.00717854,0.00727856,0.00737858,0.0074786,0.00757861,0.00767863,0.00777864,0.00787854,0.00797856,0.00807857,0.00817859,0.00827861,0.00837863,0.00847864,0.00857866,0.00867855,0.00877857,0.00887859,0.00897861,0.00907862,0.00917864,0.00927866,0.00937855,0.00947857,0.00957859,0.0096786,0.00977862,0.00987864,0.00997865,0.0100786,0.0101786,0.0102786,0.0103786,0.0104786,0.0105786,0.0106786,0.0107785,0.0108786,0.0112786,0.0116786,0.0120786,0.0124786,0.0128787,0.0132786,0.0136785,0.0140786,0.0144786,0.0148786,0.0152786,0.0156786,0.0160786,0.0164787,0.0168786,0.0172786,0.0176786,0.0180786,0.0184786,0.0188786,0.0192787,0.0196786,0.0200787,0.0204786,0.0208785,0.0212786,0.0216786,0.0220786,0.0224786,0.0228787,0.0232786,0.0236785,0.0240786,0.0244786,0.0248786,0.0252786,0.0256786,0.0260786,0.0264786,0.0268786,0.0272785,0.0276786,0.0280786,0.0284786,0.0288786,0.0292786,0.0296786,0.0300786,0.0304786,0.0308785])
b3=np.array([650.453,650.453,650.453,650.453,650.453,650.453,1082.87,1453.56,1757.8,2019,2250.79,2461.12,2654.94,2835.6,3005.43,3166.17,3319.13,3465.34,3605.61,3740.62,3870.91,3996.94,4119.11,4237.76,4353.15,4465.56,4575.21,4682.28,4786.94,4889.36,4989.68,5088.01,5184.47,5279.16,5372.19,5463.62,5553.54,5642.03,5729.15,5814.95,5899.51,5982.87,6065.08,6146.19,6226.24,6305.27,6383.31,6460.42,6536.61,6611.92,6686.38,6760.02,6832.86,6904.93,6976.26,7046.86,7116.76,7185.97,7254.53,7322.44,7389.72,7456.4,7522.48,7587.99,7652.93,7717.33,7781.19,7844.53,7907.36,7969.69,8031.54,8092.91,8153.82,8214.28,8274.3,8333.88,8393.03,8451.77,8510.1,8568.04,8625.59,8682.75,8739.53,8795.95,8852.01,8907.72,8963.07,9018.09,9072.77,9127.12,9181.15,9234.86,9288.26,9341.35,9394.15,9446.64,9498.84,9550.76,9602.4,9653.76,9704.84,9755.66,9806.21,9856.5,9906.54,9956.32,8036.21,7078.32,6457.87,6003.18,5647.49,5357.72,5114.92,4907.22,4726.65,4567.65,4426.14,4299.08,4184.13,4079.45,3983.58,3895.33,3813.74,3738,3667.44,3601.48,3539.65,3481.53,3426.75,3375.01,3326.04,3279.59,3235.46,3193.46,3153.41,3115.18,3078.63,3043.63,3010.09,2977.89,2946.96,2917.22,2888.58,2860.98,2834.36,2808.67,2783.84,2759.84,2736.61,2714.12,2692.33,2671.2,2650.7,2630.8,2611.46,2592.67,2292.53,2085.74,1934.64,1819.07,1727.44,1652.72,1590.36,1537.35,1491.58,1451.55,1416.16,1384.57,1356.15,1330.41,1306.93,1285.41,1265.59,1247.24,1230.2,1214.32,1199.47,1185.54,1172.43,1160.08,1148.4,1137.35,1126.86,1116.88,1107.39,1098.33,1089.68,1081.41,1073.48,1065.89,1058.59,1051.58,1044.84,1038.34,1032.08,1026.04,1020.21,1014.57,1009.12,1003.84,998.732,993.781,988.979,984.32,979.796,975.402,971.13,966.977,962.936,959.002,955.171,951.438,947.8,944.252,940.791,937.414,934.117,930.897,927.751,924.677,921.672,918.733,915.858,913.045,910.292,907.596,904.957,902.371,899.837,897.354,894.919,892.532,890.191,887.894,885.64,883.429,881.258,879.126,877.033,874.977,872.957,870.972,869.022,867.105,865.22,863.367,861.544,859.752,857.988,856.253,854.546,852.865,851.211,849.583,847.98,846.401,843.337,840.362,837.472,834.664,831.933,829.278,826.694,824.178,821.729,819.343,817.018,814.751,812.54,810.384,808.28,806.226,804.221,802.262,800.349,798.479,796.652,794.865,793.117,791.408,789.735,788.098,786.495,784.927,783.39,781.885,780.41,778.966,777.549,776.161,774.8,773.465,772.155,770.871,769.611,768.374,767.16,765.969,764.799,763.65,762.521,761.413,760.325,759.255,758.204,757.171,753.302,749.674,746.265,743.059,740.039,737.189,734.498,731.953,729.544,727.261,725.095,723.038,721.083,719.223,717.452,715.765,714.156,712.621,711.155,709.754,708.414,707.132,705.904,704.728,703.6,702.519,701.481,700.484,699.526,698.606,697.72,696.868,696.048,695.258,694.496,693.763,693.054,692.371,691.712,691.074,690.459,689.864,689.288,688.731,688.192,687.67,687.164,686.674,686.199,685.738])

path_where_to_save_everything = '/home/ffederic/work/Collaboratory/test/experimental_data/Marc_Mentat_target_temp_test/'
plt.figure(figsize=(20, 10))
plt.plot(a*1e3,b,label='full simulated temperature')
plt.plot(a*1e3,power_input(a,0)/np.max(power_input(a,0))*b.max(0),':b',label='power input (rescaled), energy input~22J')
plt.legend(loc='best')
plt.xlabel('time [ms]')
plt.ylabel('temperature [K]')
plt.grid()
figure_index+=1
plt.savefig(path_where_to_save_everything +'Figure_'+str(figure_index)+'.png', bbox_inches='tight')
plt.close('all')
# plt.pause(0.01)

plt.figure(figsize=(20, 10))
plt.plot(a*1e3,b,color=color[0],label='full simulated temperature')
time_after_peak=1.5e-3
plt.plot([a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]*1e3]*2,[0,b.max()],'--k')
bds = [[20,1e-3,3e-1,0],[np.inf,np.inf,1,a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]]]
guess=[b[0],1,0.5,0.]
fit = curve_fit(semi_infinite_sink_full_decrease(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]), a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin():], b[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin():], guess,bounds=bds,x_scale=[100,1e5,1e-3,1e-4],maxfev=int(1e4),ftol=1e-15,xtol=1e-15)
fit_wit_errors = correlated_values(fit[0],fit[1])
energy = fit_wit_errors[1]*2*np.pi*(0.005**2)
pulse_duration_ms = 1e3*(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]-fit_wit_errors[3])*fit_wit_errors[2]
plt.plot(a[a-fit[0][3]>nominal_values(pulse_duration_ms)*1e-3]*1e3,semi_infinite_sink_full_decrease(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()])(a[a-fit[0][3]>nominal_values(pulse_duration_ms)*1e-3],*fit[0]),color=color[1],label='double root, E='+str(energy)+'J, t0=%.3g+/-%.3gms, tau=%.3g+/-%.3gms, T0=%.3g+/-%.3gK, F0=%.3g+/-%.3gW/m2' %(nominal_values(fit_wit_errors[3]*1e3),std_devs(fit_wit_errors[3]*1e3),nominal_values(pulse_duration_ms),std_devs(pulse_duration_ms),nominal_values(fit_wit_errors[0]),std_devs(fit_wit_errors[0]),nominal_values(fit_wit_errors[1]*1e3/pulse_duration_ms),std_devs(fit_wit_errors[1]*1e3/pulse_duration_ms)))
plt.plot(a[a-fit[0][3]<=nominal_values(pulse_duration_ms)*1e-3]*1e3,semi_infinite_sink_full_increase(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()])(a[a-fit[0][3]<=nominal_values(pulse_duration_ms)*1e-3],*fit[0]),color=color[1])
plt.legend(loc='best')
plt.xlabel('time [ms]')
plt.ylabel('temperature [K]')
plt.ylim(bottom=0,top=b.max()*1.2)
plt.xlim(right=10)
plt.grid()
figure_index+=1
plt.savefig(path_where_to_save_everything +'Figure_'+str(figure_index)+'.png', bbox_inches='tight')
plt.close('all')
# plt.pause(0.01)

all_energy1 = []
all_energy2 = []
all_energy3 = []
all_energy4 = []
for time_after_peak in np.array([0.5,1,1.5,2,3,5])*1e-3:
	plt.figure(figsize=(20, 10))
	plt.plot(a*1e3,b,color=color[0],label='full simulated temperature')
	# plt.plot(a1*1e3,b1,label='simulated step: t0=%.3gms, tau=%.3g, F=%.3gW/m2' %(0.000616*1e3,1.34e-05*1e3,(13.25+0.0917*0.1)*8e8))
	# plt.plot(a2*1e3,b2,label='simulated step: t0=%.3gms, tau=%.3g, F=%.3gW/m2' %(1e-07*1e3,0.00108*1e3,(0.1678+0.0917*0.1)*8e8))
	# plt.plot(a3*1e3,b3,label='simulated step: t0=%.3gms, tau=%.3g, F=%.3gW/m2' %(0.000762*1e3,1.66e-05*1e3,(10.31+0.0917*0.1)*8e8))
	# bds = [[20,1e-3,1e-4,1],[np.inf,np.inf,1e-3,1.0005]]
	# bds = [[b[0]-1,1e-3,1e-6,0],[b[0]+1,np.inf,1,a[np.abs(a-(a[b.argmax()]+1.5e-3)).argmin()]]]
	# time_after_peak = 5e-3
	plt.title('Temperature profile used from ts=%.3gms after the temperature peak' %(time_after_peak*1e3))
	bds1 = [[20,1e-3,1e-2,0],[np.inf,np.inf,1,a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]]]
	guess1=[b[0],1,0.5,0.]
	bds2 = [[20,1e-3,1e-8,0],[np.inf,np.inf,1e-6,a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]]]
	guess2=[b[0],1,1e-6,0.]
	bds3 = [[20,1e-3,1e-2,0],[np.inf,np.inf,1,1e-7]]
	guess3=[b[0],1,0.5,0.]
	bds4 = [[20,1e-3,0.999,0],[np.inf,np.inf,1,a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]]]
	guess4=[b[0],1,1,0.]
	# plt.plot([1.5e-3]*2,[b.min(),b.max()],'--k')
	plt.plot([a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]*1e3]*2,[0,b.max()],'--k')
	for i,arg in enumerate([[bds1,guess1],[bds2,guess2],[bds3,guess3],[bds4,guess4]]):
		bds,guess = arg
		# print(guess)
		fit = curve_fit(semi_infinite_sink_full_decrease(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]), a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin():], b[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin():], guess,bounds=bds,x_scale=[100,1e5,1e-3,1e-4],maxfev=int(1e4),ftol=1e-15,xtol=1e-15)
		fit_wit_errors = correlated_values(fit[0],fit[1])
		energy = fit_wit_errors[1]*2*np.pi*(0.005**2)
		pulse_duration_ms = 1e3*(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]-fit_wit_errors[3])*fit_wit_errors[2]
		# print(fit_wit_errors)
		if i==0:
			all_energy1.append(energy)
			plt.plot(a[a-fit[0][3]>nominal_values(pulse_duration_ms)*1e-3]*1e3,semi_infinite_sink_full_decrease(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()])(a[a-fit[0][3]>nominal_values(pulse_duration_ms)*1e-3],*fit[0]),color=color[1],label='free double root, E='+str(energy)+'J, t0=%.3g+/-%.3gms, tau=%.3g+/-%.3gms, T0=%.3g+/-%.3gK, F0=%.3g+/-%.3gW/m2' %(nominal_values(fit_wit_errors[3]*1e3),std_devs(fit_wit_errors[3]*1e3),nominal_values(pulse_duration_ms),std_devs(pulse_duration_ms),nominal_values(fit_wit_errors[0]),std_devs(fit_wit_errors[0]),nominal_values(fit_wit_errors[1]*1e3/pulse_duration_ms),std_devs(fit_wit_errors[1]*1e3/pulse_duration_ms)))
			plt.plot(a[a-fit[0][3]<=nominal_values(pulse_duration_ms)*1e-3]*1e3,semi_infinite_sink_full_increase(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()])(a[a-fit[0][3]<=nominal_values(pulse_duration_ms)*1e-3],*fit[0]),color=color[1])
		elif i==1:
			all_energy2.append(energy)
			plt.plot(a[a-fit[0][3]>nominal_values(pulse_duration_ms)*1e-3]*1e3,semi_infinite_sink_full_decrease(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()])(a[a-fit[0][3]>nominal_values(pulse_duration_ms)*1e-3],*fit[0]),'--',color=color[2],label='constrained (taus<1e-6)  E='+str(energy)+'J, t0=%.3g+/-%.3gms, tau=%.3g+/-%.3gms, T0=%.3g+/-%.3gK, F0=%.3g+/-%.3gW/m2' %(nominal_values(fit_wit_errors[3]*1e3),std_devs(fit_wit_errors[3]*1e3),nominal_values(pulse_duration_ms),std_devs(pulse_duration_ms),nominal_values(fit_wit_errors[0]),std_devs(fit_wit_errors[0]),nominal_values(fit_wit_errors[1]*1e3/pulse_duration_ms),std_devs(fit_wit_errors[1]*1e3/pulse_duration_ms)))
			plt.plot(a[a-fit[0][3]<=nominal_values(pulse_duration_ms)*1e-3]*1e3,semi_infinite_sink_full_increase(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()])(a[a-fit[0][3]<=nominal_values(pulse_duration_ms)*1e-3],*fit[0]),'--',color=color[2])
		elif i==2:
			all_energy3.append(energy)
			plt.plot(a[a-fit[0][3]>nominal_values(pulse_duration_ms)*1e-3]*1e3,semi_infinite_sink_full_decrease(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()])(a[a-fit[0][3]>nominal_values(pulse_duration_ms)*1e-3],*fit[0]),'--',color=color[3],label='constrained (t0<1e-7)  E='+str(energy)+'J, t0=%.3g+/-%.3gms, tau=%.3g+/-%.3gms, T0=%.3g+/-%.3gK, F0=%.3g+/-%.3gW/m2' %(nominal_values(fit_wit_errors[3]*1e3),std_devs(fit_wit_errors[3]*1e3),nominal_values(pulse_duration_ms),std_devs(pulse_duration_ms),nominal_values(fit_wit_errors[0]),std_devs(fit_wit_errors[0]),nominal_values(fit_wit_errors[1]*1e3/pulse_duration_ms),std_devs(fit_wit_errors[1]*1e3/pulse_duration_ms)))
			plt.plot(a[a-fit[0][3]<=nominal_values(pulse_duration_ms)*1e-3]*1e3,semi_infinite_sink_full_increase(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()])(a[a-fit[0][3]<=nominal_values(pulse_duration_ms)*1e-3],*fit[0]),'--',color=color[3])
		elif i==3:
			all_energy4.append(energy)
			plt.plot(a[a-fit[0][3]>nominal_values(pulse_duration_ms)*1e-3]*1e3,semi_infinite_sink_full_decrease(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()])(a[a-fit[0][3]>nominal_values(pulse_duration_ms)*1e-3],*fit[0]),'--',color=color[4],label='constrained (taus>0.999)  E='+str(energy)+'J, t0=%.3g+/-%.3gms, tau=%.3g+/-%.3gms, T0=%.3g+/-%.3gK, F0=%.3g+/-%.3gW/m2' %(nominal_values(fit_wit_errors[3]*1e3),std_devs(fit_wit_errors[3]*1e3),nominal_values(pulse_duration_ms),std_devs(pulse_duration_ms),nominal_values(fit_wit_errors[0]),std_devs(fit_wit_errors[0]),nominal_values(fit_wit_errors[1]*1e3/pulse_duration_ms),std_devs(fit_wit_errors[1]*1e3/pulse_duration_ms)))
			plt.plot(a[a-fit[0][3]<=nominal_values(pulse_duration_ms)*1e-3]*1e3,semi_infinite_sink_full_increase(a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()])(a[a-fit[0][3]<=nominal_values(pulse_duration_ms)*1e-3],*fit[0]),'--',color=color[4])
	# guess = [1000,1e8,1e-3,0]
	# bds=[[20,0,0,0],[np.inf,np.inf,np.inf,np.inf]]
	# fit = curve_fit(exponential_decay, a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin():], b[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin():], guess,bounds=bds,maxfev=int(1e4),xtol=1e-15)#,ftol=1e-12)
	# fit_wit_errors = correlated_values(fit[0],fit[1])
	# plt.plot(a*1e3,exponential_decay(a,*fit[0]),'--',label='exponential decay')

	plt.plot(a*1e3,power_input(a,0)/np.max(power_input(a,0))*b.max(0),':',color=color[5],label='power input (rescaled), energy input~22J')
	plt.legend(loc='best', fontsize='small')
	plt.ylim(bottom=0,top=b.max()*1.2)
	plt.xlim(left=-1,right=15)
	plt.xlabel('time [ms]')
	plt.ylabel('temperature [K]')
	plt.grid()
	figure_index+=1
	plt.savefig(path_where_to_save_everything +'Figure_'+str(figure_index)+'.png', bbox_inches='tight')
	plt.close('all')
	# plt.pause(0.01)

all_energy1 = np.array(all_energy1)
all_energy2 = np.array(all_energy2)
all_energy3 = np.array(all_energy3)
all_energy4 = np.array(all_energy4)
plt.figure(figsize=(20, 10))
plt.errorbar(np.array([0.5,1,1.5,2,3,5]),nominal_values(all_energy1),yerr=std_devs(all_energy1),label='free double root')
plt.errorbar(np.array([0.5,1,1.5,2,3,5]),nominal_values(all_energy2),yerr=std_devs(all_energy2),linestyle='--',label='constrained (taus<1e-6)')
plt.errorbar(np.array([0.5,1,1.5,2,3,5]),nominal_values(all_energy3),yerr=std_devs(all_energy3),linestyle='--',label='constrained (t0<1e-7)')
plt.errorbar(np.array([0.5,1,1.5,2,3,5]),nominal_values(all_energy4),yerr=std_devs(all_energy4),linestyle='--',label='constrained (taus>0.999)')
plt.plot([0,5],[22]*2,'--')
plt.xlabel('start of profile used after temperature peak (ts) [ms]')
plt.ylabel('fitted energy [J]')
plt.legend(loc='best', fontsize='small')
plt.grid()
figure_index+=1
plt.savefig(path_where_to_save_everything +'Figure_'+str(figure_index)+'.png', bbox_inches='tight')
plt.close('all')
# plt.pause(0.01)

plt.figure(figsize=(20, 10))
plt.plot(a*1e3,b,label='full simulated temperature')
plt.plot(a1*1e3,b1,label='simulated step: t0=%.3gms, tau=%.3gms, F0=%.3gW/m2' %(0.000616*1e3,1.34e-05*1e3,(13.25+0.0917*0.1)*8e8))
plt.plot(a2*1e3,b2,label='simulated step: t0=%.3gms, tau=%.3gms, F0=%.3gW/m2' %(1e-07*1e3,0.00108*1e3,(0.1678+0.0917*0.1)*8e8))
plt.plot(a3*1e3,b3,label='simulated step: t0=%.3gms, tau=%.3gms, F0=%.3gW/m2' %(0.000762*1e3,1.66e-05*1e3,(10.31+0.0917*0.1)*8e8))
plt.legend(loc='best')
plt.xlabel('time [ms]')
plt.ylabel('temperature [K]')
time_after_peak = 1.5e-3
plt.plot([a[np.abs(a-(a[b.argmax()]+time_after_peak)).argmin()]*1e3]*2,[b.min(),b.max()],'--k')
plt.ylim(bottom=b.min()/1.2,top=b.max()*1.2)
plt.xlim(left=-1,right=15)
plt.grid()
figure_index+=1
plt.savefig(path_where_to_save_everything +'Figure_'+str(figure_index)+'.png', bbox_inches='tight')
plt.close('all')
# plt.pause(0.01)

if False:
	guess = [1000,1e8,1e-3,1]
	bds=[[20,0,0,1],[np.inf,np.inf,np.inf,np.inf]]
	fit = curve_fit(exponential_decay, a[a>=1.0015], b[a>=1.0015], guess,bounds=bds,maxfev=int(1e4),xtol=1e-15)#,ftol=1e-12)
	fit_wit_errors = correlated_values(fit[0],fit[1])
	plt.plot(a,exponential_decay(a,*fit[0]),':')
	plt.legend(loc='best')
	plt.grid()
	# figure_index+=1
	# plt.savefig(path_where_to_save_everything +'Figure_'+str(figure_index)+'.png', bbox_inches='tight')
	# plt.close('all')
	plt.pause(0.01)



c=np.array([0,0.00000907572,0.0000207208,0.0000338475,0.0000474074,0.0000610294,0.0000747899,0.0000887175,0.000102839,0.000117459,0.000132012,0.000146336,0.000160487,0.000174555,0.000188592,0.000202616,0.000216638,0.000230657,0.000244676,0.000258627,0.000272643,0.000286584,0.000300475,0.000314378,0.000328406,0.000342433,0.000356384,0.00037041,0.000384434,0.000398456,0.000412477,0.000426497,0.000440523,0.000454553,0.000468577,0.000482596,0.000496612,0.000510626,0.000524639,0.000538651,0.000552663,0.000566674,0.00058069,0.000594702,0.000608713,0.000622723,0.000636732,0.00065074,0.000664749,0.000678756,0.000692764,0.000706771,0.000720778,0.000734785,0.000748792,0.000762798,0.000776804,0.000790776,0.000804782,0.000818788,0.000832794,0.0008468,0.000860805,0.00087481,0.000888816,0.00090282,0.000916825,0.00093083,0.000944835,0.000958839,0.000972843,0.000986847,0.00100085,0.00101486,0.00102886,0.00104286,0.00105687,0.00107087,0.00108487,0.00109888,0.00111288,0.00112688,0.00114089,0.00115489,0.00116889,0.00118289,0.0011969,0.0012109,0.0012249,0.0012389,0.00125291,0.00126691,0.00128091,0.00129491,0.00130892,0.00132292,0.00133692,0.00135092,0.00136493,0.00137893,0.00139293,0.00140693,0.00142093,0.00143494,0.00144894,0.00146294,0.00147694,0.00149094,0.00150494,0.00151895,0.00153295,0.00154695,0.00156095,0.00157495,0.00158895,0.00160296,0.00161696,0.00163096,0.00164496,0.00165896,0.00167296,0.00168696,0.00170097,0.00171497,0.00172897,0.00174297,0.00175697,0.00177097,0.00178497,0.00179897,0.00181298,0.00182698,0.00184098,0.00185498,0.00186898,0.00188298,0.00189698,0.00191098,0.00192498,0.00193898,0.00195298,0.00196699,0.00198099,0.00199499,0.00200899,0.00202299,0.00203699,0.00205099,0.00206499,0.00207899,0.00209299,0.00210699,0.00212099,0.002135,0.002149,0.002163,0.002177,0.002191,0.002205,0.002219,0.002233,0.002247,0.002261,0.002275,0.002289,0.002303,0.002317,0.002331,0.002345,0.002359,0.00237301,0.00238701,0.00240101,0.00241501,0.00242901,0.00244301,0.00245701,0.00247101,0.00248501,0.00249901,0.00251301,0.00252701,0.00254101,0.00255501,0.00256901,0.00258301,0.00259701,0.00261101,0.00262501,0.00263901,0.00265301,0.00266702,0.00268102,0.00269502,0.00270902,0.00272302,0.00273702,0.00275102,0.00276502,0.00277902,0.00279302,0.00280702,0.00282102,0.00283502,0.00284902,0.00286302,0.00287702,0.00289102,0.00290502,0.00291902,0.00293302,0.00294702,0.00296102,0.00297502,0.00298902,0.00300302,0.00301702,0.00303102,0.00304502,0.00305902,0.00307302,0.00308702,0.00310102,0.00311502,0.00312902,0.00314302,0.00315702,0.00317102,0.00318502,0.00319902,0.00321302,0.00322702,0.00324102,0.00325502,0.00326902,0.00328303,0.00329702,0.00331102,0.00332503,0.00333902,0.00335302,0.00336703,0.00338103,0.00339502,0.00340902,0.00342303,0.00343702,0.00345102,0.00346503,0.00347903,0.00349302,0.00350703,0.00352103,0.00353503,0.00354902,0.00356303,0.00357703,0.00359103,0.00360502,0.00361903,0.00363302,0.00364702,0.00366103,0.00367503,0.00368902,0.00370302,0.00371703,0.00373102,0.00374502,0.00375903,0.00377303,0.00378702,0.00380102,0.00381503,0.00382902,0.00384302,0.00385702,0.00387102,0.00388502,0.00389902,0.00391302,0.00392702,0.00394102,0.00395502,0.00396902,0.00398302,0.00399702,0.00401102,0.00402502,0.00403902,0.00405302,0.00406702,0.00408102,0.00409502,0.00410902,0.00412302,0.00413702,0.00415102,0.00416502,0.00417902,0.00419302,0.00420702,0.00422102,0.00423502,0.00424902,0.00426302,0.00427702,0.00429102,0.00430502,0.00431902,0.00433302,0.00434702,0.00436102,0.00437502,0.00438902,0.00440302,0.00441702,0.00443101,0.00444502,0.00445901,0.00447301,0.00448701,0.00450101,0.00451501,0.00452901,0.00454301,0.00455701,0.00457101,0.00458501,0.00459901,0.00461301,0.00462701,0.00464101,0.00465501,0.00466901,0.00468301,0.00469701,0.00471101,0.00472501,0.00473901,0.00475301,0.004767,0.004781,0.004795,0.004809,0.004823,0.004837,0.004851,0.004865,0.004879,0.004893,0.004907,0.004921,0.004935,0.004949,0.004963,0.00497699,0.00499099,0.00500499,0.00501899,0.00503299,0.00504699,0.00506099,0.00507499,0.00508899,0.00510299,0.00511699,0.00513099,0.00514499,0.00515898,0.00517298,0.00518698,0.00520098,0.00521498,0.00522898,0.00524298,0.00525698,0.00527098,0.00528497,0.00529897,0.00531297,0.00532697,0.00534097,0.00535497,0.00536897,0.00538297,0.00539697,0.00541096,0.00542496,0.00543896,0.00545296,0.00546696,0.00548096,0.00549496,0.00550895,0.00552295,0.00553695,0.00555095,0.00556495,0.00557895,0.00559295,0.00560694,0.00562094,0.00563494,0.00564894,0.00566294,0.00567693,0.00569093,0.00570493,0.00571893,0.00573293,0.00574692,0.00576092,0.00577492,0.00578892,0.00580292,0.00581691,0.00583091,0.00584491,0.00585891,0.0058729,0.0058869,0.0059009,0.00591489,0.00592889,0.00594289,0.00595689,0.00597088,0.00598488,0.00599888,0.00601287,0.00602687,0.00604087,0.00605486,0.00606886,0.00608286,0.00609685,0.00611085,0.00612484,0.00613884,0.00615283,0.00616683,0.00618083,0.00619482,0.00620882,0.00622281,0.00623681,0.0062508,0.0062648,0.00627879,0.00629278,0.00630681,0.00632081,0.0063348,0.0063488,0.00636279,0.00637678,0.00639078,0.00640477,0.00641876,0.00643275,0.00644675,0.00646074,0.00647473,0.00648872,0.00650271,0.0065167,0.00653069,0.00654468,0.00655867,0.00657266,0.00658665,0.00660063,0.00661462,0.00662861,0.00664259,0.00665658,0.00667056,0.00668454,0.00669852,0.00671249,0.00672647,0.00674045,0.00675443,0.0067684,0.00678238,0.00679635,0.00681039,0.00682437,0.00683857,0.00685264,0.00686667,0.00688061,0.00689445,0.00690827,0.00692205,0.00693588,0.00694979,0.00696489,0.00698097,0.00699277,0.00700172,0.00701228,0.00702724,0.00705401,0.00708569,0.00712019,0.00715642,0.00719363,0.00723093,0.00726832,0.0073067,0.00734276,0.00737863,0.00741422,0.00744984,0.00748516,0.00752032,0.00755532,0.00759005,0.00762498,0.0076596,0.00769426,0.00772734,0.00776107,0.00779501,0.00782919,0.00786338,0.00789767,0.00793234,0.00796723,0.00800232,0.00803745,0.00807219,0.00810647,0.0081404,0.00817508,0.00821077,0.00824671,0.0082824,0.00831749,0.00835223,0.00838744,0.0084234,0.00845936,0.00849465,0.00852881,0.00856207,0.00859524,0.00862923,0.0086641,0.00869947,0.00873486,0.00876983,0.00880355,0.00883676,0.00887259,0.00891012,0.00894674,0.00898227,0.0090162,0.00904953,0.00908496,0.00912142,0.00915691,0.00919153,0.00922486,0.0092578,0.00929326,0.00933019,0.00936581,0.00939964,0.00943263,0.00946788,0.00950454,0.00953998,0.00957381,0.00960698,0.00964272,0.00968002,0.00971597,0.0097501,0.00978355,0.0098193,0.00985626,0.00989181,0.0099256,0.00995873,0.00999419,0.010031,0.0100665,0.0101002,0.0101333,0.0101688,0.0102056,0.0102412,0.0102749,0.0103078,0.010343,0.0103797,0.0104154,0.0104494,0.010483,0.0105192,0.0105571,0.0105935,0.010628,0.010662,0.010698,0.0107346,0.0107695,0.0108025,0.0108349,0.0108696,0.010906,0.0109414,0.0109755,0.0110091,0.0110452,0.0110828,0.0111188,0.0111531,0.0111869,0.0112229,0.0112597,0.0112948,0.011328,0.0113608,0.0113959,0.0114323,0.0114675,0.0115014,0.0115348,0.0115708,0.0116083,0.0116444,0.0116787,0.0117125,0.0117484,0.0117851,0.01182,0.0118531,0.0118857,0.0119207,0.0119571,0.0119927,0.0120268,0.0120604,0.0120965,0.012134,0.01217,0.0122042,0.0122379,0.0122738,0.0123106,0.0123458,0.0123791,0.012412,0.0124472,0.0124836,0.0125188,0.0125525,0.0125859,0.0126219,0.0126593,0.0126954,0.0127296,0.0127635,0.0127998,0.0128369,0.0128725,0.012906,0.0129392,0.0129745,0.013011,0.0130463,0.0130802,0.0131137,0.0131493,0.0131858,0.013221,0.0132546,0.0132879,0.0133235,0.0133605,0.0133967,0.0134321,0.0134663,0.0135005,0.0135372,0.0135742,0.0136094,0.0136435,0.0136769,0.0137091,0.0137404,0.0137736,0.0138092,0.0138456,0.013881,0.0139155,0.0139503,0.013989,0.014024])
# profile at peak temperature
d=np.array([2277.78,2279.3,2276.65,2274.59,2274.14,2273.14,2272.04,2270.91,2269.81,2269.06,2269.09,2269.46,2269.7,2269.76,2269.71,2269.61,2269.48,2269.33,2269.17,2269,2268.81,2268.61,2268.42,2268.23,2267.96,2267.68,2267.42,2267.1,2266.76,2266.41,2266.04,2265.66,2265.26,2264.86,2264.44,2264,2263.54,2263.06,2262.57,2262.06,2261.54,2261,2260.46,2259.89,2259.32,2258.72,2258.11,2257.49,2256.86,2256.21,2255.54,2254.86,2254.17,2253.47,2252.75,2252.01,2251.26,2250.55,2249.77,2248.98,2248.18,2247.36,2246.53,2245.69,2244.83,2243.96,2243.07,2242.18,2241.26,2240.34,2239.4,2238.45,2237.49,2236.51,2235.52,2234.51,2233.49,2232.46,2231.42,2230.36,2229.29,2228.21,2227.11,2226,2224.88,2223.75,2222.6,2221.44,2220.26,2219.08,2217.88,2216.67,2215.44,2214.21,2212.96,2211.69,2210.42,2209.13,2207.83,2206.52,2205.19,2203.86,2202.51,2201.14,2199.77,2198.38,2196.98,2195.57,2194.15,2192.71,2191.26,2189.8,2188.33,2186.84,2185.35,2183.84,2182.32,2180.79,2179.24,2177.69,2176.12,2174.54,2172.95,2171.34,2169.73,2168.1,2166.47,2164.82,2163.16,2161.48,2159.8,2158.1,2156.4,2154.68,2152.95,2151.21,2149.46,2147.69,2145.92,2144.13,2142.34,2140.53,2138.71,2136.88,2135.04,2133.19,2131.33,2129.45,2127.57,2125.68,2123.77,2121.86,2119.93,2117.99,2116.05,2114.09,2112.12,2110.14,2108.15,2106.15,2104.14,2102.12,2100.09,2098.05,2096,2093.94,2091.87,2089.79,2087.7,2085.6,2083.49,2081.38,2079.24,2077.11,2074.96,2072.8,2070.63,2068.45,2066.27,2064.07,2061.87,2059.65,2057.43,2055.2,2052.95,2050.7,2048.44,2046.17,2043.89,2041.61,2039.31,2037,2034.69,2032.37,2030.04,2027.7,2025.35,2022.99,2020.62,2018.25,2015.87,2013.48,2011.08,2008.67,2006.26,2003.83,2001.4,1998.96,1996.51,1994.06,1991.59,1989.12,1986.64,1984.15,1981.66,1979.15,1976.64,1974.13,1971.6,1969.07,1966.53,1963.98,1961.43,1958.87,1956.3,1953.72,1951.14,1948.55,1945.95,1943.35,1940.73,1938.12,1935.49,1932.86,1930.22,1927.58,1924.92,1922.27,1919.6,1916.93,1914.26,1911.57,1908.88,1906.19,1903.48,1900.78,1898.06,1895.34,1892.62,1889.88,1887.14,1884.4,1881.65,1878.9,1876.14,1873.37,1870.6,1867.82,1865.04,1862.25,1859.46,1856.66,1853.85,1851.05,1848.23,1845.41,1842.59,1839.76,1836.92,1834.09,1831.24,1828.39,1825.54,1822.68,1819.82,1816.95,1814.08,1811.21,1808.33,1805.44,1802.56,1799.66,1796.77,1793.87,1790.96,1788.05,1785.14,1782.22,1779.3,1776.38,1773.45,1770.52,1767.58,1764.64,1761.7,1758.75,1755.8,1752.85,1749.9,1746.94,1743.97,1741.01,1738.04,1735.07,1732.09,1729.12,1726.13,1723.15,1720.16,1717.18,1714.18,1711.19,1708.19,1705.19,1702.19,1699.19,1696.18,1693.17,1690.16,1687.15,1684.13,1681.11,1678.09,1675.07,1672.05,1669.02,1665.99,1662.96,1659.93,1656.9,1653.87,1650.83,1647.79,1644.75,1641.71,1638.67,1635.63,1632.58,1629.54,1626.49,1623.44,1620.39,1617.34,1614.29,1611.24,1608.18,1605.13,1602.07,1599.02,1595.96,1592.9,1589.85,1586.79,1583.73,1580.67,1577.61,1574.55,1571.49,1568.43,1565.36,1562.3,1559.24,1556.18,1553.12,1550.06,1546.99,1543.93,1540.87,1537.81,1534.75,1531.69,1528.63,1525.57,1522.51,1519.45,1516.39,1513.33,1510.27,1507.22,1504.16,1501.1,1498.05,1494.99,1491.94,1488.89,1485.84,1482.79,1479.74,1476.69,1473.64,1470.59,1467.55,1464.51,1461.46,1458.42,1455.38,1452.34,1449.31,1446.27,1443.23,1440.2,1437.17,1434.14,1431.12,1428.09,1425.07,1422.04,1419.02,1416,1412.99,1409.97,1406.96,1403.95,1400.94,1397.93,1394.93,1391.93,1388.93,1385.93,1382.93,1379.94,1376.95,1373.96,1370.98,1367.99,1365.01,1362.03,1359.06,1356.09,1353.12,1350.15,1347.18,1344.22,1341.26,1338.31,1335.35,1332.4,1329.45,1326.51,1323.57,1320.63,1317.69,1314.76,1311.83,1308.91,1305.98,1303.07,1300.15,1297.24,1294.33,1291.42,1288.5,1285.6,1282.7,1279.81,1276.92,1274.04,1271.16,1268.28,1265.4,1262.53,1259.67,1256.8,1253.94,1251.09,1248.24,1245.39,1242.54,1239.7,1236.87,1234.04,1231.21,1228.38,1225.56,1222.75,1219.93,1217.13,1214.32,1211.52,1208.72,1205.93,1203.15,1200.36,1197.58,1194.81,1192.04,1189.27,1186.49,1183.73,1180.91,1178.17,1175.49,1172.84,1170.19,1167.54,1164.86,1162.11,1158.96,1154.44,1153.15,1147.62,1143.72,1139.23,1140.31,1135.8,1128.76,1121.33,1113.9,1106.64,1099.59,1092.7,1085.74,1079.82,1073.94,1068.21,1062.4,1056.77,1051.14,1045.51,1039.88,1033.99,1028.24,1022.53,1016.06,1009.94,1003.85,997.844,991.85,985.812,979.764,973.666,967.704,961.975,956.34,950.77,944.872,938.713,932.624,926.802,921.403,916.185,910.804,905.164,899.7,894.672,890.078,885.647,881.17,876.15,870.772,865.353,860.149,855.113,850.436,845.931,840.316,834.38,829.352,824.824,820.623,816.743,811.837,806.749,802.514,798.471,794.637,790.789,786.125,781.126,776.847,772.994,769.331,764.886,760.131,756.069,752.329,748.723,744.331,739.717,735.788,732.28,729.008,725.027,720.812,717.274,714.035,710.904,707.129,703.086,699.548,696.315,693.234,689.58,685.746,682.401,679.343,676.422,672.923,669.192,665.877,662.858,659.961,656.489,652.846,649.779,647.074,644.585,641.6,638.504,635.942,633.548,631.146,628.324,625.222,622.409,619.791,617.335,614.43,611.418,608.846,606.505,604.329,601.777,599.087,596.849,594.794,592.839,590.465,587.913,585.666,583.546,581.546,579.185,576.705,574.551,572.644,570.859,568.767,566.592,564.76,563.057,561.407,559.453,557.344,555.442,553.71,552.068,550.153,548.159,546.434,544.883,543.437,541.737,539.965,538.476,537.125,535.826,534.276,532.645,531.19,529.819,528.523,527.01,525.399,524.001,522.757,521.577,520.214,518.792,517.592,516.537,515.531,514.341,513.092,512.007,511.002,510.066,508.985,507.88,506.93,506.061,505.248,504.27,503.261,502.378,501.569,500.83,500.14,499.336,498.54,497.946,497.419,496.916,496.448,496.022,495.533,494.971,494.444,494.024,493.712,493.429,493.14,494.463,494.411])
# profile at peak +1.5ms
d1=np.array([1131.1,1131.14,1131.07,1131,1130.98,1130.93,1130.88,1130.83,1130.77,1130.71,1130.67,1130.64,1130.6,1130.55,1130.49,1130.43,1130.36,1130.29,1130.21,1130.13,1130.05,1129.96,1129.86,1129.77,1129.66,1129.55,1129.44,1129.32,1129.19,1129.07,1128.93,1128.8,1128.65,1128.51,1128.35,1128.2,1128.04,1127.87,1127.7,1127.52,1127.35,1127.16,1126.97,1126.78,1126.58,1126.38,1126.17,1125.96,1125.74,1125.52,1125.3,1125.07,1124.83,1124.59,1124.35,1124.1,1123.85,1123.59,1123.33,1123.06,1122.79,1122.52,1122.24,1121.95,1121.67,1121.37,1121.08,1120.77,1120.47,1120.16,1119.84,1119.52,1119.2,1118.87,1118.54,1118.2,1117.86,1117.51,1117.16,1116.8,1116.44,1116.08,1115.71,1115.34,1114.96,1114.58,1114.2,1113.81,1113.41,1113.02,1112.61,1112.21,1111.8,1111.38,1110.96,1110.54,1110.11,1109.68,1109.24,1108.8,1108.35,1107.9,1107.45,1106.99,1106.53,1106.07,1105.6,1105.12,1104.64,1104.16,1103.67,1103.18,1102.69,1102.19,1101.69,1101.18,1100.67,1100.15,1099.63,1099.11,1098.58,1098.05,1097.52,1096.98,1096.44,1095.89,1095.34,1094.78,1094.22,1093.66,1093.09,1092.52,1091.95,1091.37,1090.79,1090.2,1089.61,1089.02,1088.42,1087.82,1087.21,1086.61,1085.99,1085.38,1084.76,1084.13,1083.5,1082.87,1082.24,1081.6,1080.96,1080.31,1079.66,1079.01,1078.35,1077.69,1077.02,1076.36,1075.68,1075.01,1074.33,1073.65,1072.96,1072.27,1071.58,1070.88,1070.19,1069.48,1068.78,1068.07,1067.35,1066.64,1065.92,1065.19,1064.46,1063.73,1063,1062.27,1061.52,1060.78,1060.03,1059.28,1058.53,1057.77,1057.01,1056.25,1055.48,1054.72,1053.94,1053.17,1052.39,1051.61,1050.82,1050.03,1049.24,1048.45,1047.65,1046.85,1046.05,1045.24,1044.43,1043.62,1042.8,1041.98,1041.16,1040.34,1039.51,1038.68,1037.85,1037.01,1036.17,1035.33,1034.49,1033.64,1032.79,1031.94,1031.09,1030.23,1029.37,1028.5,1027.64,1026.77,1025.9,1025.02,1024.15,1023.27,1022.38,1021.5,1020.61,1019.72,1018.83,1017.94,1017.04,1016.14,1015.24,1014.33,1013.43,1012.52,1011.6,1010.69,1009.77,1008.86,1007.93,1007.01,1006.08,1005.16,1004.23,1003.29,1002.36,1001.42,1000.48,999.539,998.595,997.649,996.701,995.751,994.799,993.844,992.888,991.929,990.968,990.006,989.041,988.074,987.106,986.135,985.162,984.188,983.212,982.233,981.253,980.271,979.287,978.301,977.314,976.324,975.333,974.34,973.346,972.349,971.351,970.351,969.35,968.346,967.342,966.335,965.327,964.317,963.306,962.293,961.279,960.263,959.246,958.227,957.206,956.184,955.161,954.136,953.11,952.083,951.054,950.023,948.992,947.958,946.924,945.889,944.852,943.813,942.774,941.733,940.691,939.648,938.604,937.558,936.512,935.464,934.415,933.365,932.314,931.262,930.209,929.154,928.099,927.043,925.986,924.927,923.868,922.808,921.747,920.685,919.622,918.558,917.494,916.428,915.362,914.295,913.227,912.158,911.089,910.019,908.948,907.876,906.804,905.731,904.657,903.583,902.508,901.432,900.356,899.279,898.202,897.124,896.046,894.967,893.887,892.807,891.727,890.646,889.564,888.483,887.4,886.318,885.235,884.151,883.068,881.984,880.899,879.814,878.729,877.644,876.559,875.473,874.387,873.301,872.214,871.127,870.041,868.954,867.866,866.779,865.692,864.605,863.517,862.429,861.342,860.254,859.166,858.078,856.991,855.903,854.815,853.728,852.64,851.553,850.465,849.378,848.291,847.204,846.117,845.03,843.944,842.857,841.771,840.685,839.6,838.514,837.429,836.344,835.259,834.175,833.091,832.007,830.924,829.841,828.758,827.676,826.594,825.513,824.432,823.351,822.271,821.192,820.112,819.034,817.956,816.878,815.801,814.725,813.648,812.573,811.498,810.424,809.35,808.277,807.205,806.133,805.062,803.992,802.922,801.853,800.784,799.717,798.65,797.584,796.519,795.454,794.39,793.327,792.265,791.204,790.143,789.081,788.022,786.964,785.906,784.85,783.795,782.74,781.687,780.634,779.583,778.532,777.482,776.434,775.386,774.339,773.294,772.249,771.206,770.163,769.122,768.081,767.042,766.004,764.967,763.931,762.896,761.863,760.831,759.8,758.77,757.742,756.714,755.688,754.663,753.639,752.617,751.591,750.571,749.535,748.511,747.493,746.482,745.48,744.48,743.483,742.482,741.466,740.343,739.246,738.358,737.684,736.888,735.982,734.087,731.802,729.328,726.748,724.117,721.496,718.883,716.214,713.734,711.277,708.851,706.43,704.042,701.673,699.323,697,694.666,692.365,690.072,687.865,685.636,683.405,681.171,678.946,676.724,674.49,672.25,670.014,667.791,665.605,663.457,661.332,659.168,656.957,654.751,652.583,650.464,648.372,646.259,644.12,642.005,639.952,637.977,636.058,634.14,632.179,630.181,628.173,626.182,624.234,622.367,620.51,618.521,616.481,614.515,612.626,610.838,609.061,607.188,605.301,603.479,601.718,600.029,598.346,596.548,594.713,592.965,591.315,589.694,587.974,586.222,584.547,582.958,581.389,579.714,578.003,576.376,574.845,573.334,571.732,570.113,568.574,567.122,565.688,564.167,562.62,561.146,559.754,558.385,556.932,555.453,554.045,552.718,551.42,550.042,548.634,547.285,546.006,544.745,543.397,542.021,540.72,539.501,538.299,537.038,535.785,534.606,533.5,532.409,531.25,530.06,528.917,527.831,526.762,525.626,524.473,523.383,522.361,521.354,520.294,519.238,518.247,517.317,516.401,515.431,514.448,513.509,512.621,511.746,510.816,509.874,508.983,508.151,507.333,506.477,505.627,504.831,504.086,503.355,502.582,501.796,501.046,500.339,499.645,498.913,498.177,497.487,496.844,496.214,495.554,494.902,494.294,493.728,493.172,492.59,492.007,491.456,490.94,490.435,489.904,489.371,488.874,488.414,487.965,487.498,487.039,486.617,486.229,485.85,485.459,485.075,484.715,484.384,484.061,483.733,483.413,483.119,482.85,482.59,482.324,482.065,481.827,481.608,481.408,481.216,481.024,480.85,480.698,480.562,480.44,480.333,480.236,480.143,480.056,479.983,479.926,479.883,479.851,479.882,479.877])
# profile at peak +3ms
d2=np.array([952.251,952.293,952.218,952.157,952.136,952.098,952.055,952.008,951.958,951.915,951.89,951.872,951.847,951.815,951.777,951.735,951.69,951.641,951.589,951.534,951.475,951.414,951.351,951.284,951.213,951.138,951.061,950.979,950.894,950.807,950.715,950.621,950.523,950.423,950.319,950.211,950.101,949.987,949.87,949.75,949.627,949.5,949.371,949.238,949.102,948.963,948.821,948.676,948.527,948.375,948.221,948.063,947.902,947.738,947.57,947.4,947.226,947.051,946.872,946.689,946.503,946.314,946.122,945.927,945.728,945.527,945.322,945.115,944.904,944.691,944.474,944.254,944.032,943.806,943.577,943.345,943.11,942.872,942.631,942.387,942.14,941.89,941.637,941.381,941.122,940.86,940.595,940.327,940.056,939.782,939.505,939.226,938.943,938.657,938.368,938.077,937.782,937.485,937.184,936.881,936.575,936.266,935.954,935.639,935.321,935,934.677,934.35,934.021,933.689,933.354,933.016,932.675,932.332,931.986,931.636,931.284,930.929,930.572,930.212,929.848,929.482,929.114,928.742,928.368,927.991,927.611,927.229,926.843,926.456,926.065,925.671,925.275,924.877,924.475,924.071,923.664,923.255,922.842,922.428,922.01,921.59,921.167,920.742,920.314,919.883,919.45,919.014,918.576,918.135,917.691,917.245,916.797,916.345,915.892,915.435,914.977,914.515,914.052,913.585,913.116,912.645,912.171,911.695,911.216,910.735,910.252,909.766,909.277,908.787,908.293,907.798,907.3,906.799,906.296,905.791,905.284,904.774,904.262,903.747,903.231,902.711,902.19,901.666,901.14,900.612,900.082,899.549,899.014,898.477,897.937,897.395,896.851,896.305,895.757,895.207,894.654,894.099,893.542,892.983,892.422,891.859,891.293,890.726,890.156,889.584,889.011,888.435,887.857,887.277,886.695,886.111,885.525,884.937,884.347,883.755,883.161,882.565,881.967,881.367,880.765,880.162,879.556,878.948,878.339,877.728,877.114,876.499,875.883,875.264,874.643,874.021,873.397,872.771,872.143,871.513,870.882,870.249,869.614,868.977,868.339,867.699,867.057,866.414,865.769,865.122,864.473,863.823,863.171,862.518,861.863,861.206,860.548,859.888,859.227,858.564,857.899,857.233,856.565,855.896,855.226,854.553,853.88,853.204,852.528,851.85,851.17,850.489,849.807,849.123,848.438,847.751,847.063,846.373,845.683,844.99,844.297,843.602,842.906,842.208,841.51,840.81,840.108,839.406,838.702,837.997,837.29,836.583,835.874,835.164,834.453,833.74,833.027,832.312,831.596,830.88,830.161,829.442,828.722,828,827.278,826.554,825.83,825.104,824.377,823.65,822.921,822.191,821.46,820.729,819.996,819.262,818.528,817.792,817.056,816.318,815.58,814.841,814.101,813.36,812.618,811.875,811.132,810.387,809.642,808.896,808.149,807.402,806.653,805.904,805.154,804.404,803.653,802.9,802.148,801.394,800.64,799.885,799.13,798.373,797.617,796.859,796.101,795.342,794.583,793.823,793.063,792.302,791.54,790.778,790.015,789.252,788.488,787.724,786.959,786.194,785.428,784.662,783.895,783.128,782.361,781.593,780.824,780.056,779.286,778.517,777.747,776.977,776.206,775.435,774.664,773.892,773.12,772.348,771.576,770.803,770.03,769.256,768.483,767.709,766.935,766.161,765.386,764.611,763.837,763.062,762.286,761.511,760.736,759.96,759.184,758.408,757.632,756.856,756.08,755.304,754.528,753.751,752.975,752.198,751.422,750.645,749.869,749.092,748.316,747.539,746.763,745.986,745.21,744.434,743.657,742.881,742.105,741.329,740.553,739.778,739.002,738.226,737.451,736.676,735.901,735.126,734.351,733.577,732.802,732.028,731.254,730.481,729.707,728.934,728.161,727.389,726.616,725.844,725.072,724.301,723.53,722.759,721.988,721.218,720.448,719.679,718.909,718.141,717.372,716.604,715.837,715.069,714.303,713.536,712.77,712.003,711.237,710.473,709.709,708.945,708.182,707.419,706.657,705.895,705.134,704.373,703.613,702.854,702.095,701.336,700.578,699.821,699.064,698.308,697.553,696.798,696.044,695.29,694.537,693.785,693.033,692.282,691.532,690.783,690.034,689.286,688.538,687.791,687.045,686.3,685.556,684.809,684.065,683.311,682.564,681.823,681.087,680.356,679.627,678.899,678.168,677.424,676.592,675.804,675.131,674.624,674.025,673.388,672.007,670.328,668.511,666.617,664.688,662.765,660.848,658.889,657.072,655.27,653.49,651.713,649.959,648.218,646.489,644.779,643.058,641.36,639.667,638.03,636.378,634.724,633.068,631.417,629.767,628.107,626.442,624.779,623.126,621.5,619.901,618.315,616.698,615.047,613.4,611.782,610.201,608.637,607.054,605.453,603.872,602.338,600.861,599.425,597.984,596.508,595.004,593.494,591.995,590.531,589.126,587.721,586.215,584.677,583.195,581.772,580.425,579.079,577.659,576.234,574.858,573.527,572.248,570.969,569.601,568.21,566.885,565.635,564.399,563.088,561.756,560.483,559.275,558.076,556.796,555.493,554.255,553.089,551.933,550.708,549.473,548.3,547.192,546.093,544.927,543.743,542.617,541.552,540.5,539.385,538.252,537.174,536.157,535.159,534.099,533.017,531.983,531.002,530.029,528.991,527.934,526.936,526.001,525.076,524.105,523.144,522.239,521.389,520.548,519.653,518.737,517.857,517.022,516.196,515.319,514.432,513.594,512.808,512.031,511.213,510.401,509.64,508.925,508.218,507.469,506.712,505.989,505.306,504.63,503.913,503.187,502.503,501.863,501.232,500.572,499.919,499.307,498.735,498.171,497.574,496.969,496.392,495.849,495.314,494.75,494.184,493.654,493.161,492.675,492.167,491.667,491.2,490.766,490.338,489.889,489.441,489.018,488.622,488.233,487.823,487.414,487.033,486.68,486.334,485.974,485.622,485.299,485.001,484.71,484.409,484.113,483.837,483.583,483.335,483.081,482.836,482.61,482.404,482.202,481.997,481.798,481.614,481.445,481.291,481.142,480.994,480.86,480.743,480.638,480.544,480.462,480.386,480.313,480.244,480.187,480.143,480.109,480.082,480.115,480.11])
# profile at peak +5ms
d3=np.array([862.776,862.817,862.743,862.683,862.665,862.63,862.59,862.547,862.502,862.465,862.446,862.435,862.418,862.394,862.365,862.333,862.298,862.26,862.22,862.177,862.132,862.085,862.035,861.984,861.928,861.87,861.811,861.747,861.681,861.612,861.541,861.467,861.391,861.313,861.231,861.148,861.061,860.973,860.881,860.787,860.691,860.592,860.491,860.387,860.281,860.172,860.061,859.947,859.831,859.713,859.592,859.468,859.342,859.214,859.083,858.95,858.814,858.678,858.537,858.394,858.248,858.101,857.95,857.798,857.642,857.485,857.325,857.163,856.998,856.831,856.661,856.489,856.315,856.138,855.959,855.777,855.593,855.407,855.219,855.028,854.834,854.639,854.441,854.24,854.037,853.832,853.625,853.415,853.203,852.988,852.772,852.553,852.331,852.107,851.881,851.653,851.422,851.189,850.954,850.717,850.477,850.235,849.99,849.744,849.495,849.244,848.99,848.734,848.476,848.216,847.954,847.689,847.422,847.153,846.882,846.608,846.332,846.054,845.774,845.491,845.207,844.92,844.631,844.34,844.047,843.751,843.453,843.154,842.852,842.548,842.241,841.933,841.622,841.31,840.995,840.678,840.359,840.038,839.714,839.389,839.062,838.732,838.401,838.067,837.731,837.393,837.054,836.712,836.368,836.022,835.674,835.324,834.972,834.618,834.261,833.904,833.543,833.181,832.817,832.451,832.083,831.713,831.341,830.967,830.592,830.214,829.834,829.453,829.069,828.684,828.296,827.907,827.516,827.123,826.728,826.331,825.932,825.532,825.13,824.725,824.319,823.911,823.502,823.09,822.677,822.261,821.845,821.426,821.005,820.583,820.159,819.733,819.305,818.876,818.445,818.012,817.577,817.141,816.703,816.263,815.822,815.378,814.933,814.487,814.039,813.589,813.137,812.684,812.229,811.773,811.315,810.855,810.394,809.931,809.466,809,808.533,808.063,807.592,807.12,806.646,806.171,805.694,805.215,804.735,804.253,803.77,803.286,802.799,802.312,801.823,801.332,800.84,800.347,799.852,799.356,798.858,798.359,797.858,797.356,796.853,796.348,795.842,795.334,794.825,794.315,793.803,793.29,792.776,792.26,791.743,791.225,790.705,790.185,789.662,789.139,788.614,788.088,787.561,787.033,786.503,785.972,785.44,784.907,784.372,783.836,783.299,782.761,782.222,781.681,781.14,780.597,780.053,779.508,778.962,778.414,777.866,777.317,776.766,776.214,775.662,775.108,774.553,773.997,773.44,772.882,772.323,771.763,771.202,770.64,770.077,769.513,768.948,768.382,767.815,767.247,766.678,766.109,765.538,764.967,764.394,763.821,763.246,762.671,762.095,761.519,760.941,760.362,759.783,759.203,758.621,758.04,757.457,756.873,756.289,755.704,755.118,754.532,753.944,753.356,752.767,752.178,751.587,750.996,750.405,749.812,749.219,748.625,748.031,747.436,746.84,746.244,745.647,745.049,744.451,743.852,743.252,742.652,742.051,741.45,740.848,740.246,739.643,739.039,738.435,737.83,737.225,736.62,736.013,735.407,734.8,734.192,733.584,732.975,732.366,731.757,731.147,730.536,729.926,729.314,728.703,728.091,727.479,726.866,726.253,725.639,725.025,724.411,723.796,723.181,722.566,721.95,721.335,720.718,720.102,719.485,718.868,718.251,717.633,717.015,716.397,715.779,715.16,714.541,713.922,713.303,712.684,712.064,711.444,710.824,710.204,709.584,708.963,708.343,707.722,707.101,706.48,705.859,705.238,704.617,703.995,703.374,702.752,702.13,701.509,700.887,700.265,699.643,699.021,698.399,697.778,697.156,696.534,695.912,695.29,694.668,694.046,693.424,692.803,692.181,691.559,690.938,690.316,689.694,689.073,688.452,687.831,687.21,686.589,685.968,685.347,684.727,684.106,683.486,682.866,682.246,681.626,681.007,680.387,679.768,679.149,678.53,677.912,677.293,676.675,676.057,675.44,674.822,674.205,673.589,672.972,672.354,671.738,671.122,670.507,669.891,669.277,668.662,668.048,667.434,666.821,666.208,665.595,664.982,664.37,663.759,663.148,662.537,661.926,661.316,660.706,660.097,659.488,658.88,658.272,657.664,657.057,656.451,655.845,655.24,654.635,654.03,653.426,652.822,652.219,651.617,651.015,650.41,649.809,649.199,648.595,647.995,647.4,646.809,646.219,645.63,645.038,644.433,643.751,643.122,642.56,642.138,641.64,641.143,640.026,638.661,637.183,635.644,634.077,632.516,630.96,629.369,627.896,626.435,624.992,623.549,622.126,620.712,619.308,617.918,616.517,615.135,613.757,612.418,611.07,609.719,608.366,607.018,605.669,604.311,602.949,601.589,600.238,598.908,597.6,596.299,594.972,593.618,592.268,590.943,589.648,588.365,587.066,585.752,584.456,583.2,581.99,580.812,579.627,578.412,577.173,575.931,574.698,573.494,572.338,571.176,569.931,568.664,567.445,566.274,565.166,564.053,562.879,561.705,560.571,559.475,558.42,557.361,556.227,555.078,553.985,552.952,551.927,550.839,549.738,548.685,547.686,546.69,545.626,544.547,543.522,542.558,541.597,540.578,539.555,538.584,537.665,536.751,535.779,534.797,533.862,532.978,532.102,531.171,530.23,529.334,528.489,527.656,526.771,525.87,525.009,524.192,523.379,522.511,521.631,520.8,520.022,519.249,518.438,517.638,516.884,516.174,515.471,514.722,513.956,513.221,512.523,511.831,511.096,510.354,509.655,508.998,508.347,507.661,506.983,506.346,505.749,505.156,504.527,503.893,503.287,502.715,502.147,501.544,500.936,500.363,499.826,499.296,498.742,498.194,497.682,497.202,496.727,496.225,495.716,495.232,494.776,494.325,493.85,493.374,492.929,492.515,492.105,491.677,491.257,490.865,490.5,490.139,489.76,489.383,489.027,488.693,488.364,488.018,487.673,487.352,487.054,486.761,486.457,486.16,485.887,485.636,485.39,485.134,484.885,484.652,484.437,484.226,484.011,483.804,483.613,483.438,483.267,483.092,482.923,482.767,482.624,482.493,482.366,482.24,482.126,482.026,481.937,481.857,481.787,481.722,481.659,481.6,481.55,481.512,481.483,481.46,481.493,481.488])

guess = [400,1000,0.005]
all_areas = []
plt.figure(figsize=(20, 10))
plt.plot(c*1e3,power_input(0,c)/power_input(0,c).max(),':',color=color[0],label='input heat profile')
plt.plot([5]*2,[0,1],':',color=color[0])
# all_areas.append(2*np.pi*(0.005**2))

plt.plot(c*1e3,d/d.max(),color=color[1],label='temp profile at peak temperature')
fit = curve_fit(gaussian_1D_fitting,c,d,guess)
fit_wit_errors = correlated_values(fit[0],fit[1])
plt.plot(c*1e3,gaussian_1D_fitting(c,*fit[0])/gaussian_1D_fitting(c,*fit[0]).max(),'--',color=color[1],label='gaussian fit, sigma=%.3g+/-%.3gmm' %(nominal_values(fit_wit_errors[2]*1e3),std_devs(fit_wit_errors[2]*1e3)))
plt.plot([fit[0][2]*1e3]*2,[0,1],'--',color=color[1])
all_areas.append(2*np.pi*((fit_wit_errors[2])**2))

plt.plot(c*1e3,d1/d1.max(),color=color[2],label='temp profile at peak temperature + 1.5ms')
fit = curve_fit(gaussian_1D_fitting,c,d1,guess)
fit_wit_errors = correlated_values(fit[0],fit[1])
plt.plot(c*1e3,gaussian_1D_fitting(c,*fit[0])/gaussian_1D_fitting(c,*fit[0]).max(),'--',color=color[2],label='gaussian fit, sigma=%.3g+/-%.3gmm' %(nominal_values(fit_wit_errors[2]*1e3),std_devs(fit_wit_errors[2]*1e3)))
plt.plot([fit[0][2]*1e3]*2,[0,1],'--',color=color[2])
all_areas.append(2*np.pi*((fit_wit_errors[2])**2))

plt.plot(c*1e3,d2/d2.max(),color=color[3],label='temp profile at peak temperature + 3ms')
fit = curve_fit(gaussian_1D_fitting,c,d2,guess)
fit_wit_errors = correlated_values(fit[0],fit[1])
plt.plot(c*1e3,gaussian_1D_fitting(c,*fit[0])/gaussian_1D_fitting(c,*fit[0]).max(),'--',color=color[3],label='gaussian fit, sigma=%.3g+/-%.3gmm' %(nominal_values(fit_wit_errors[2]*1e3),std_devs(fit_wit_errors[2]*1e3)))
plt.plot([fit[0][2]*1e3]*2,[0,1],'--',color=color[3])
all_areas.append(2*np.pi*((fit_wit_errors[2])**2))

plt.plot(c*1e3,d3/d3.max(),color=color[4],label='temp profile at peak temperature + 5ms')
fit = curve_fit(gaussian_1D_fitting,c,d3,guess)
fit_wit_errors = correlated_values(fit[0],fit[1])
plt.plot(c*1e3,gaussian_1D_fitting(c,*fit[0])/gaussian_1D_fitting(c,*fit[0]).max(),'--',color=color[4],label='gaussian fit, sigma=%.3g+/-%.3gmm' %(nominal_values(fit_wit_errors[2]*1e3),std_devs(fit_wit_errors[2]*1e3)))
plt.plot([fit[0][2]*1e3]*2,[0,1],'--',color=color[4])
all_areas.append(2*np.pi*((fit_wit_errors[2])**2))

plt.legend(loc='best')
plt.xlabel('radious [mm]')
plt.ylabel('fraction of max [au]')
plt.grid()
# plt.ylim(bottom=b.min()/1.2,top=b.max()*1.2)
# plt.xlim(left=-1,right=15)
figure_index=11
plt.savefig(path_where_to_save_everything +'Figure_'+str(figure_index)+'.png', bbox_inches='tight')
plt.close('all')
# plt.pause(0.01)

plt.figure(figsize=(20, 10))
plt.errorbar([0,1.5,3,5],nominal_values(all_areas)/(2*np.pi*(0.005**2)),yerr=std_devs(all_areas)/(2*np.pi*(0.005**2)))
# plt.plot([0,5],[2*np.pi*(0.005**2)]*2,'--')
plt.plot([0,5],[1]*2,'--')
plt.xlabel('time after peak temp [ms]')
plt.ylabel('measured area / reference area [au]')
plt.grid()
figure_index+=1
plt.savefig(path_where_to_save_everything +'Figure_'+str(figure_index)+'.png', bbox_inches='tight')
plt.close('all')
# plt.pause(0.01)


# simulated weak pulses
# heat_flux = 2e8e^(-(r^2)/(2*(0.005^2)))*(0.0917*0.1+0.5*0.7*e^(-((t-0.00033-1)^2)/(2*(0.000144^2)))+0.5*0.208*e^(-((t-0.000457-1)^2)/(2*(0.000218^2))))

guess=[650.,1,1e-3,1.]
a=np.array([1.00131,1.00146,1.00164,1.00171,1.00193,1.00219,1.0025,1.00288,1.00334,1.00388,1.00448,1.00508,1.00568,1.00628,1.00688,1.00748,1.00808,1.00868,1.00928,1.00988,1.01048,1.01108,1.01168,1.01228,1.01288,1.01348,1.01408,1.01468,1.01528,1.01588,1.01648,1.01708,1.01768,1.01828,1.01888,1.01948,1.02008,1.02068,1.02128,1.02188,1.02248,1.02308,1.02368,1.02428,1.02488,1.02548,1.02608,1.02668,1.02728,1.02788,1.02848,1.02908,1.02968,1.03])
b=np.array([551.856,537.721,524.395,519.705,508.059,496.936,486.351,476.322,466.865,457.992,450.251,443.974,438.777,434.402,430.666,427.44,424.625,422.148,419.954,417.996,416.24,414.658,413.225,411.922,410.734,409.646,408.647,407.728,406.88,406.095,405.368,404.693,404.064,403.478,402.931,402.42,401.941,401.491,401.069,400.673,400.299,399.947,399.614,399.3,399.003,398.722,398.456,398.203,397.962,397.734,397.517,397.31,397.112,397.009])
bds = [[20,1e-3,1e-4,1],[np.inf,np.inf,1e-3,1.0005]]
# fit = curve_fit(semi_infinite_sink_full_decrease, a, b, guess,bounds=bds,maxfev=int(1e4),xtol=1e-15,ftol=1e-12)
fit = curve_fit(semi_infinite_sink_full_decrease, a[a>=1.0015+0.00046], b[a>=1.0015+0.00046], guess,bounds=bds,maxfev=int(1e4))#,xtol=1e-15,ftol=1e-12)
fit_wit_errors = correlated_values(fit[0],fit[1])
fit_wit_errors[1]*2*np.pi*(0.005**2)
guess = [1000,1e8,1e-3,1]
bds=[[20,0,0,1],[np.inf,np.inf,np.inf,np.inf]]
fit = curve_fit(exponential_decay, a, b, guess,bounds=bds,maxfev=int(1e4),xtol=1e-15,ftol=1e-12)
fit = curve_fit(exponential_decay, a[a>=1.0015], b[a>=1.0015], guess,bounds=bds,maxfev=int(1e4))#,xtol=1e-15,ftol=1e-12)

c=np.array([0,9.07572E-06,2.07208E-05,3.38475E-05,4.74074E-05,6.10294E-05,7.47899E-05,8.87175E-05,0.000102839,0.000117459,0.000132012,0.000146336,0.000160487,0.000174555,0.000188591,0.000202616,0.000216638,0.000230657,0.000244676,0.000258627,0.000272643,0.000286584,0.000300475,0.000314378,0.000328406,0.000342433,0.000356384,0.00037041,0.000384433,0.000398456,0.000412477,0.000426497,0.000440523,0.000454553,0.000468577,0.000482596,0.000496612,0.000510626,0.000524639,0.000538651,0.000552663,0.000566674,0.00058069,0.000594702,0.000608713,0.000622723,0.000636732,0.00065074,0.000664749,0.000678756,0.000692764,0.000706771,0.000720778,0.000734785,0.000748792,0.000762798,0.000776804,0.000790776,0.000804782,0.000818788,0.000832794,0.0008468,0.000860805,0.00087481,0.000888816,0.00090282,0.000916825,0.00093083,0.000944834,0.000958839,0.000972843,0.000986847,0.00100085,0.00101486,0.00102886,0.00104286,0.00105687,0.00107087,0.00108487,0.00109888,0.00111288,0.00112688,0.00114089,0.00115489,0.00116889,0.00118289,0.0011969,0.0012109,0.0012249,0.00123891,0.00125291,0.00126691,0.00128091,0.00129492,0.00130892,0.00132292,0.00133692,0.00135092,0.00136493,0.00137893,0.00139293,0.00140693,0.00142093,0.00143494,0.00144894,0.00146294,0.00147694,0.00149094,0.00150494,0.00151895,0.00153295,0.00154695,0.00156095,0.00157495,0.00158895,0.00160296,0.00161696,0.00163096,0.00164496,0.00165896,0.00167296,0.00168696,0.00170097,0.00171497,0.00172897,0.00174297,0.00175697,0.00177097,0.00178497,0.00179897,0.00181297,0.00182698,0.00184098,0.00185498,0.00186898,0.00188298,0.00189698,0.00191098,0.00192498,0.00193898,0.00195298,0.00196699,0.00198099,0.00199499,0.00200899,0.00202299,0.00203699,0.00205099,0.00206499,0.00207899,0.00209299,0.00210699,0.00212099,0.002135,0.002149,0.002163,0.002177,0.002191,0.002205,0.002219,0.002233,0.002247,0.002261,0.002275,0.002289,0.002303,0.002317,0.002331,0.002345,0.00235901,0.00237301,0.00238701,0.00240101,0.00241501,0.00242901,0.00244301,0.00245701,0.00247101,0.00248501,0.00249901,0.00251301,0.00252701,0.00254101,0.00255501,0.00256901,0.00258301,0.00259701,0.00261101,0.00262501,0.00263901,0.00265301,0.00266701,0.00268102,0.00269502,0.00270902,0.00272302,0.00273702,0.00275102,0.00276502,0.00277902,0.00279302,0.00280702,0.00282102,0.00283502,0.00284902,0.00286302,0.00287702,0.00289102,0.00290502,0.00291902,0.00293302,0.00294702,0.00296102,0.00297502,0.00298902,0.00300302,0.00301702,0.00303102,0.00304502,0.00305902,0.00307302,0.00308702,0.00310102,0.00311502,0.00312902,0.00314302,0.00315702,0.00317102,0.00318502,0.00319902,0.00321302,0.00322702,0.00324102,0.00325502,0.00326902,0.00328302,0.00329702,0.00331102,0.00332502,0.00333902,0.00335303,0.00336703,0.00338103,0.00339503,0.00340903,0.00342303,0.00343703,0.00345103,0.00346503,0.00347903,0.00349303,0.00350703,0.00352103,0.00353503,0.00354903,0.00356303,0.00357703,0.00359103,0.00360503,0.00361903,0.00363303,0.00364703,0.00366103,0.00367503,0.00368903,0.00370303,0.00371703,0.00373103,0.00374503,0.00375902,0.00377302,0.00378702,0.00380102,0.00381502,0.00382902,0.00384302,0.00385702,0.00387102,0.00388502,0.00389902,0.00391302,0.00392702,0.00394102,0.00395502,0.00396902,0.00398302,0.00399702,0.00401102,0.00402502,0.00403902,0.00405302,0.00406702,0.00408102,0.00409502,0.00410902,0.00412302,0.00413702,0.00415102,0.00416502,0.00417902,0.00419302,0.00420702,0.00422102,0.00423502,0.00424902,0.00426302,0.00427702,0.00429102,0.00430502,0.00431902,0.00433302,0.00434702,0.00436102,0.00437502,0.00438902,0.00440302,0.00441702,0.00443102,0.00444501,0.00445901,0.00447301,0.00448701,0.00450101,0.00451501,0.00452901,0.00454301,0.00455701,0.00457101,0.00458501,0.00459901,0.00461301,0.00462701,0.00464101,0.00465501,0.00466901,0.00468301,0.00469701,0.00471101,0.00472501,0.00473901,0.004753,0.004767,0.004781,0.004795,0.004809,0.004823,0.004837,0.004851,0.004865,0.004879,0.004893,0.004907,0.004921,0.004935,0.004949,0.004963,0.00497699,0.00499099,0.00500499,0.00501899,0.00503299,0.00504699,0.00506099,0.00507499,0.00508899,0.00510299,0.00511699,0.00513099,0.00514498,0.00515898,0.00517298,0.00518698,0.00520098,0.00521498,0.00522898,0.00524298,0.00525698,0.00527098,0.00528497,0.00529897,0.00531297,0.00532697,0.00534097,0.00535497,0.00536897,0.00538297,0.00539697,0.00541096,0.00542496,0.00543896,0.00545296,0.00546696,0.00548096,0.00549496,0.00550895,0.00552295,0.00553695,0.00555095,0.00556495,0.00557895,0.00559295,0.00560694,0.00562094,0.00563494,0.00564894,0.00566294,0.00567693,0.00569093,0.00570493,0.00571893,0.00573293,0.00574692,0.00576092,0.00577492,0.00578892,0.00580292,0.00581691,0.00583091,0.00584491,0.00585891,0.0058729,0.0058869,0.0059009,0.0059149,0.00592889,0.00594289,0.00595689,0.00597088,0.00598488,0.00599888,0.00601287,0.00602687,0.00604087,0.00605486,0.00606886,0.00608286,0.00609685,0.00611085,0.00612484,0.00613884,0.00615284,0.00616683,0.00618083,0.00619482,0.00620882,0.00622281,0.00623681,0.0062508,0.0062648,0.00627879,0.00629278,0.00630681,0.00632081,0.0063348,0.0063488,0.00636279,0.00637678,0.00639078,0.00640477,0.00641876,0.00643275,0.00644675,0.00646074,0.00647473,0.00648872,0.00650271,0.0065167,0.00653069,0.00654468,0.00655867,0.00657266,0.00658665,0.00660063,0.00661462,0.00662861,0.00664259,0.00665658,0.00667056,0.00668454,0.00669852,0.0067125,0.00672647,0.00674045,0.00675443,0.00676841,0.00678238,0.00679635,0.00681039,0.00682437,0.00683857,0.00685264,0.00686667,0.00688061,0.00689445,0.00690827,0.00692205,0.00693588,0.00694979,0.00696489,0.00698097,0.00699277,0.00700172,0.00701228,0.00702724,0.00705401,0.00708569,0.00712019,0.00715642,0.00719363,0.00723093,0.00726832,0.0073067,0.00734276,0.00737863,0.00741422,0.00744984,0.00748516,0.00752032,0.00755532,0.00759005,0.00762498,0.0076596,0.00769426,0.00772734,0.00776107,0.00779501,0.00782919,0.00786338,0.00789767,0.00793234,0.00796723,0.00800232,0.00803745,0.00807219,0.00810647,0.0081404,0.00817508,0.00821077,0.00824671,0.0082824,0.00831749,0.00835223,0.00838744,0.0084234,0.00845936,0.00849465,0.00852881,0.00856207,0.00859524,0.00862923,0.0086641,0.00869948,0.00873486,0.00876983,0.00880355,0.00883676,0.00887259,0.00891012,0.00894674,0.00898227,0.0090162,0.00904953,0.00908495,0.00912142,0.00915691,0.00919153,0.00922485,0.0092578,0.00929326,0.00933019,0.00936581,0.00939964,0.00943263,0.00946788,0.00950454,0.00953998,0.00957381,0.00960698,0.00964272,0.00968002,0.00971597,0.0097501,0.00978355,0.0098193,0.00985626,0.00989181,0.00992559,0.00995873,0.00999419,0.010031,0.0100665,0.0101002,0.0101333,0.0101688,0.0102056,0.0102412,0.0102749,0.0103078,0.010343,0.0103797,0.0104154,0.0104494,0.010483,0.0105192,0.0105571,0.0105935,0.0106281,0.010662,0.010698,0.0107346,0.0107695,0.0108025,0.0108349,0.0108696,0.010906,0.0109414,0.0109755,0.0110091,0.0110452,0.0110828,0.0111188,0.0111531,0.0111869,0.0112229,0.0112597,0.0112948,0.0113281,0.0113608,0.0113959,0.0114323,0.0114675,0.0115014,0.0115348,0.0115708,0.0116083,0.0116444,0.0116787,0.0117125,0.0117484,0.0117851,0.01182,0.0118531,0.0118857,0.0119207,0.0119572,0.0119927,0.0120268,0.0120604,0.0120966,0.012134,0.01217,0.0122042,0.0122379,0.0122738,0.0123106,0.0123458,0.0123791,0.012412,0.0124472,0.0124836,0.0125188,0.0125525,0.0125859,0.0126219,0.0126593,0.0126954,0.0127296,0.0127635,0.0127998,0.0128369,0.0128725,0.012906,0.0129392,0.0129745,0.013011,0.0130464,0.0130802,0.0131137,0.0131493,0.0131858,0.013221,0.0132546,0.0132879,0.0133235,0.0133605,0.0133967,0.0134321,0.0134663,0.0135005,0.0135372,0.0135743,0.0136094,0.0136435,0.0136769,0.0137091,0.0137404,0.0137736,0.0138092,0.0138456,0.0138802,0.0139152])
# profile at t=+0.002s
d=np.array([508.059,508.07,508.051,508.035,508.028,508.017,508.005,507.991,507.976,507.962,507.952,507.944,507.934,507.921,507.907,507.891,507.875,507.856,507.837,507.817,507.795,507.773,507.749,507.725,507.698,507.671,507.642,507.612,507.581,507.549,507.515,507.481,507.445,507.408,507.37,507.33,507.29,507.248,507.205,507.161,507.116,507.07,507.023,506.974,506.924,506.873,506.821,506.768,506.714,506.658,506.602,506.544,506.485,506.425,506.364,506.301,506.238,506.174,506.108,506.041,505.973,505.904,505.834,505.762,505.69,505.616,505.541,505.466,505.389,505.311,505.231,505.151,505.07,504.987,504.903,504.819,504.733,504.646,504.558,504.469,504.378,504.287,504.195,504.101,504.006,503.911,503.814,503.716,503.617,503.517,503.416,503.314,503.21,503.106,503.001,502.894,502.787,502.678,502.568,502.458,502.346,502.233,502.119,502.004,501.888,501.771,501.653,501.534,501.414,501.293,501.171,501.047,500.923,500.798,500.671,500.544,500.416,500.286,500.156,500.024,499.892,499.759,499.624,499.489,499.352,499.215,499.077,498.937,498.797,498.655,498.513,498.37,498.225,498.08,497.934,497.787,497.639,497.489,497.339,497.188,497.036,496.883,496.729,496.575,496.419,496.262,496.104,495.946,495.786,495.626,495.465,495.302,495.139,494.975,494.81,494.644,494.477,494.309,494.141,493.971,493.801,493.63,493.457,493.284,493.11,492.936,492.76,492.583,492.406,492.228,492.048,491.868,491.688,491.506,491.323,491.14,490.956,490.771,490.585,490.398,490.211,490.022,489.833,489.643,489.452,489.261,489.068,488.875,488.681,488.486,488.291,488.094,487.897,487.699,487.501,487.301,487.101,486.9,486.698,486.496,486.293,486.089,485.884,485.678,485.472,485.265,485.058,484.849,484.64,484.43,484.22,484.009,483.797,483.584,483.371,483.157,482.942,482.726,482.51,482.294,482.076,481.858,481.639,481.42,481.2,480.979,480.757,480.535,480.313,480.089,479.865,479.641,479.416,479.19,478.963,478.736,478.508,478.28,478.051,477.822,477.592,477.361,477.13,476.898,476.665,476.432,476.199,475.965,475.73,475.495,475.259,475.022,474.786,474.548,474.31,474.072,473.833,473.593,473.353,473.112,472.871,472.629,472.387,472.145,471.902,471.658,471.414,471.169,470.924,470.679,470.433,470.186,469.939,469.692,469.444,469.196,468.947,468.698,468.448,468.198,467.947,467.696,467.445,467.193,466.941,466.689,466.436,466.182,465.928,465.674,465.42,465.165,464.909,464.654,464.398,464.141,463.884,463.627,463.37,463.112,462.854,462.595,462.336,462.077,461.817,461.558,461.297,461.037,460.776,460.515,460.253,459.992,459.73,459.467,459.205,458.942,458.679,458.415,458.152,457.888,457.623,457.359,457.094,456.829,456.564,456.298,456.033,455.767,455.5,455.234,454.967,454.7,454.433,454.166,453.898,453.631,453.363,453.095,452.827,452.558,452.289,452.021,451.752,451.482,451.213,450.944,450.674,450.404,450.134,449.864,449.594,449.323,449.053,448.782,448.512,448.241,447.97,447.699,447.427,447.156,446.884,446.613,446.341,446.07,445.798,445.526,445.254,444.982,444.71,444.438,444.165,443.893,443.621,443.348,443.076,442.803,442.531,442.258,441.985,441.713,441.44,441.167,440.895,440.622,440.349,440.076,439.804,439.531,439.258,438.985,438.713,438.44,438.167,437.895,437.622,437.349,437.077,436.804,436.532,436.259,435.987,435.714,435.442,435.17,434.898,434.625,434.353,434.081,433.809,433.538,433.266,432.994,432.723,432.451,432.18,431.908,431.637,431.366,431.095,430.824,430.553,430.283,430.012,429.742,429.472,429.202,428.932,428.662,428.392,428.122,427.853,427.584,427.315,427.046,426.777,426.508,426.24,425.972,425.703,425.436,425.168,424.9,424.633,424.366,424.099,423.832,423.565,423.299,423.033,422.767,422.501,422.235,421.969,421.704,421.439,421.175,420.91,420.646,420.382,420.118,419.855,419.591,419.328,419.066,418.803,418.541,418.279,418.017,417.756,417.494,417.234,416.973,416.712,416.452,416.193,415.933,415.674,415.415,415.156,414.898,414.64,414.382,414.125,413.868,413.611,413.355,413.099,412.842,412.586,412.327,412.07,411.815,411.562,411.311,411.06,410.811,410.56,410.306,410.024,409.75,409.527,409.358,409.159,408.932,408.457,407.885,407.265,406.619,405.96,405.304,404.65,403.981,403.361,402.745,402.138,401.532,400.934,400.341,399.753,399.171,398.587,398.011,397.437,396.884,396.326,395.768,395.209,394.652,394.096,393.537,392.976,392.416,391.86,391.313,390.776,390.244,389.702,389.149,388.597,388.055,387.525,387.002,386.473,385.938,385.409,384.895,384.401,383.921,383.441,382.951,382.451,381.949,381.451,380.964,380.497,380.033,379.535,379.025,378.534,378.061,377.614,377.17,376.702,376.23,375.775,375.334,374.912,374.491,374.042,373.583,373.146,372.734,372.329,371.899,371.461,371.042,370.645,370.253,369.835,369.407,369.001,368.618,368.24,367.84,367.436,367.051,366.688,366.33,365.95,365.564,365.196,364.848,364.506,364.143,363.773,363.422,363.09,362.766,362.422,362.07,361.733,361.414,361.099,360.762,360.418,360.093,359.789,359.488,359.173,358.86,358.566,358.289,358.017,357.727,357.43,357.145,356.873,356.606,356.323,356.034,355.762,355.507,355.255,354.99,354.727,354.479,354.247,354.018,353.775,353.529,353.295,353.073,352.854,352.622,352.386,352.164,351.955,351.751,351.537,351.324,351.125,350.939,350.756,350.563,350.366,350.179,350.002,349.828,349.645,349.461,349.288,349.127,348.969,348.804,348.641,348.489,348.347,348.208,348.062,347.916,347.778,347.649,347.522,347.389,347.256,347.131,347.016,346.903,346.786,346.671,346.565,346.468,346.373,346.275,346.179,346.089,346.005,345.925,345.842,345.762,345.688,345.621,345.555,345.489,345.424,345.364,345.309,345.259,345.21,345.162,345.119,345.08,345.046,345.016,344.989,344.965,344.941,344.919,344.901,344.901,344.89])
# profile at t=+0.010s
d1=np.array([416.24,416.251,416.232,416.218,416.214,416.205,416.196,416.186,416.176,416.168,416.165,416.164,416.162,416.158,416.153,416.147,416.141,416.134,416.127,416.119,416.111,416.103,416.094,416.085,416.075,416.064,416.054,416.042,416.03,416.018,416.005,415.992,415.978,415.964,415.949,415.934,415.918,415.902,415.885,415.868,415.851,415.833,415.815,415.796,415.776,415.757,415.736,415.716,415.695,415.673,415.651,415.629,415.606,415.582,415.559,415.534,415.51,415.485,415.459,415.433,415.407,415.38,415.353,415.325,415.297,415.268,415.239,415.209,415.179,415.149,415.118,415.087,415.055,415.023,414.99,414.957,414.924,414.89,414.856,414.821,414.786,414.75,414.714,414.678,414.641,414.603,414.566,414.527,414.489,414.45,414.41,414.371,414.33,414.29,414.248,414.207,414.165,414.122,414.08,414.036,413.993,413.949,413.904,413.859,413.814,413.768,413.722,413.676,413.629,413.581,413.533,413.485,413.437,413.388,413.338,413.289,413.238,413.188,413.137,413.085,413.033,412.981,412.929,412.876,412.822,412.768,412.714,412.66,412.605,412.549,412.493,412.437,412.381,412.324,412.266,412.209,412.151,412.092,412.033,411.974,411.914,411.854,411.794,411.733,411.672,411.611,411.549,411.486,411.424,411.361,411.297,411.234,411.17,411.105,411.04,410.975,410.909,410.843,410.777,410.71,410.643,410.576,410.508,410.44,410.372,410.303,410.234,410.164,410.094,410.024,409.953,409.882,409.811,409.74,409.668,409.595,409.523,409.45,409.376,409.303,409.229,409.154,409.08,409.005,408.929,408.854,408.778,408.701,408.625,408.548,408.47,408.393,408.315,408.236,408.158,408.079,408,407.92,407.84,407.76,407.68,407.599,407.518,407.436,407.354,407.272,407.19,407.107,407.025,406.941,406.858,406.774,406.69,406.605,406.521,406.436,406.35,406.265,406.179,406.093,406.006,405.919,405.832,405.745,405.658,405.57,405.482,405.393,405.304,405.215,405.126,405.037,404.947,404.857,404.767,404.676,404.585,404.494,404.403,404.311,404.219,404.127,404.035,403.942,403.849,403.756,403.663,403.569,403.475,403.381,403.287,403.192,403.097,403.002,402.907,402.811,402.715,402.619,402.523,402.426,402.33,402.233,402.136,402.038,401.941,401.843,401.745,401.646,401.548,401.449,401.35,401.251,401.152,401.052,400.952,400.852,400.752,400.652,400.551,400.45,400.349,400.248,400.147,400.045,399.943,399.841,399.739,399.637,399.534,399.432,399.329,399.226,399.122,399.019,398.915,398.811,398.707,398.603,398.499,398.394,398.29,398.185,398.08,397.975,397.869,397.764,397.658,397.552,397.446,397.34,397.234,397.128,397.021,396.914,396.807,396.7,396.593,396.486,396.378,396.271,396.163,396.055,395.947,395.839,395.731,395.622,395.514,395.405,395.296,395.187,395.078,394.969,394.86,394.75,394.641,394.531,394.421,394.312,394.202,394.091,393.981,393.871,393.761,393.65,393.539,393.429,393.318,393.207,393.096,392.985,392.873,392.762,392.651,392.539,392.428,392.316,392.204,392.092,391.98,391.868,391.756,391.644,391.532,391.42,391.307,391.195,391.082,390.97,390.857,390.744,390.631,390.519,390.406,390.293,390.18,390.067,389.953,389.84,389.727,389.614,389.5,389.387,389.273,389.16,389.046,388.933,388.819,388.705,388.592,388.478,388.364,388.25,388.136,388.022,387.908,387.795,387.681,387.567,387.452,387.338,387.224,387.11,386.996,386.882,386.768,386.654,386.539,386.425,386.311,386.197,386.083,385.968,385.854,385.74,385.626,385.511,385.397,385.283,385.169,385.054,384.94,384.826,384.712,384.597,384.483,384.369,384.255,384.141,384.027,383.912,383.798,383.684,383.57,383.456,383.342,383.228,383.114,383,382.886,382.772,382.658,382.545,382.431,382.317,382.203,382.09,381.976,381.862,381.749,381.635,381.522,381.408,381.295,381.181,381.068,380.955,380.842,380.729,380.615,380.502,380.389,380.277,380.164,380.051,379.938,379.826,379.713,379.6,379.488,379.376,379.263,379.151,379.039,378.927,378.815,378.703,378.591,378.479,378.367,378.256,378.144,378.033,377.921,377.81,377.699,377.588,377.477,377.365,377.254,377.142,377.031,376.92,376.81,376.701,376.593,376.484,376.375,376.262,376.134,376.021,375.911,375.829,375.733,375.648,375.443,375.189,374.914,374.629,374.339,374.051,373.763,373.47,373.199,372.93,372.665,372.399,372.137,371.877,371.618,371.362,371.103,370.848,370.594,370.345,370.095,369.844,369.593,369.343,369.093,368.841,368.588,368.335,368.085,367.839,367.596,367.354,367.107,366.855,366.604,366.359,366.119,365.881,365.639,365.395,365.155,364.923,364.7,364.482,364.261,364.035,363.804,363.573,363.343,363.12,362.905,362.688,362.454,362.219,361.992,361.776,361.57,361.362,361.143,360.925,360.715,360.512,360.316,360.117,359.905,359.691,359.488,359.296,359.105,358.901,358.696,358.5,358.314,358.127,357.927,357.726,357.536,357.356,357.176,356.985,356.795,356.614,356.443,356.272,356.089,355.906,355.732,355.567,355.402,355.227,355.051,354.884,354.726,354.57,354.403,354.234,354.073,353.92,353.767,353.604,353.439,353.284,353.139,352.993,352.841,352.691,352.55,352.418,352.285,352.144,352,351.862,351.731,351.6,351.461,351.322,351.191,351.068,350.945,350.815,350.688,350.569,350.457,350.344,350.225,350.106,349.992,349.884,349.777,349.662,349.548,349.44,349.339,349.239,349.134,349.031,348.934,348.844,348.754,348.658,348.562,348.47,348.384,348.298,348.208,348.118,348.034,347.956,347.878,347.796,347.717,347.643,347.574,347.505,347.433,347.361,347.293,347.23,347.167,347.101,347.035,346.974,346.917,346.861,346.803,346.746,346.694,346.647,346.599,346.55,346.503,346.458,346.417,346.376,346.335,346.295,346.259,346.225,346.192,346.158,346.126,346.096,346.068,346.043,346.018,345.993,345.972,345.952,345.935,345.92,345.906,345.893,345.881,345.869,345.859,345.863,345.857])
guess = [400,1000,0.005]
curve_fit(gaussian_1D_fitting,c,d,guess)
curve_fit(gaussian_1D_fitting,c,d1,guess)
